!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.appSettings=e.LangHelper=e.stringResources=void 0;var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();e.UT=function(t){var e=d.get(t);return $("<i/>").addClass("UT").attr("en-text",t).attr("lang",e?v.get("uiLanguage"):s.EN).text(e||t)},e.PT=function(t){return $("<i/>").addClass("PT").attr("si-text",t).attr("script",v.get("paliScript")).text(i.TextProcessor.convert(t,v.get("paliScript")))},e.PT_REFRESH=function(t){$("i.PT",t).each(function(t,e){var n=$(e).attr("si-text");n=i.TextProcessor.convert(n,v.get("paliScript")),$(e).text(n).attr("script",v.get("paliScript"))})};var i=n(1);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=Object.freeze({SI:"si",EN:"en"}),l=new Map([[s.SI,["","සිංහල",[],{f:"sl_flag.png"}]],[s.EN,["","English",[],{f:"uk_flag.png"}]]]),c=new Map([["none",["Do Not Show",""]],["click",["Show On Click",'<n><i class="far fa-asterisk"></i></n>']],["inline",["Show Inline","<n>[…]</n>"]]]),u=new Map([["none",["Do Not Show",""]],["click",["Show On Click",'<pd class="T">¶</pd>']],["short",["Short Name",'<pd class="T">[T 1.34]</pd>']],["full",["Full Name",'<pd class="T">[Thai 3.41]</pd>']]]),f=new Map([["12",["Smallest",'<i style="font-size: 12px">Aa</i>']],["14",["Smaller",'<i style="font-size: 14px">Aa</i>']],["16",["Medium",'<i style="font-size: 16px">Aa</i>']],["19",["Larger",'<i style="font-size: 18px">Aa</i>']],["22",["Largest",'<i style="font-size: 20px">Aa</i>']],["26",["XL",'<i style="font-size: 22px">Aa</i>']],["32",["XXL",'<i style="font-size: 24px">Aa</i>']]]),h={footnoteFormat:"inline",pageTagFormat:"click",textSize:"16",uiLanguage:s.EN,tabViewFormat:"tabbed"},p=function(){function t(){o(this,t),this.settings={},this.loadFromStorage(),this.paliScriptList=i.paliScriptInfo,this.uiLanguageList=l,this.footnoteFormatList=c,this.pageTagFormatList=u,this.textSizeList=f}return a(t,[{key:"set",value:function(t,e){return this.settings[t]=e,localStorage.setItem("settings",JSON.stringify(this.settings)),e}},{key:"get",value:function(t){return this.settings[t]}},{key:"loadFromStorage",value:function(){var t=localStorage.getItem("settings");this.settings=t?JSON.parse(t):{},this.settings.paliScript?this.paliScriptSource="storage":(this.paliScriptSource="default",this.settings.paliScript=i.Script.SI),this.loadDefaults()}},{key:"loadDefaults",value:function(){var t=this;Object.keys(h).forEach(function(e){t.settings[e]||(t.settings[e]=h[e])})}}]),t}(),g=e.stringResources={"copy-link":"Link has been copied to the clipboard. You can now paste it."},d=new Map;e.LangHelper=function(){function t(){o(this,t)}return a(t,null,[{key:"extractLanguageStrings",value:function(e){t.loadTranslation(e).then(function(){var t=new Map(data_trans);$("i.UT").each(function(e,n){var r=$(n).attr("lang")==s.EN?$(n).text().trim():$(n).attr("en-text");t.has(r)||t.set(r,"")}),Object.entries(g).forEach(function(e){var n=r(e,2),a=(n[0],n[1]);t.has(a)||t.set(a,"")});var e=[];t.forEach(function(t,n){return e.push(n,t)}),console.log(e.join("\r\n"))})}},{key:"loadTranslation",value:function(t){var e="./scripts/translations/"+t+"_trans.js";return $.getScript(e,function(t,n,r){console.log("Translation script with data length "+t.length+" was loaded from file "+e+". \n                Status '"+n+":"+r.status)})}},{key:"changeTranslation",value:function(e){console.log("changing UI language to "+e),e!=s.EN?t.loadTranslation(e).then(function(){d=new Map(data_trans),$("i.UT").each(function(t,n){var r=$(n).attr("en-text")||$(n).text().trim();r||console.error("UT found with empty en-text "+$(n)),d.has(r)?$(n).attr("en-text",r).attr("lang",e).text(d.get(r)):$(n).attr("lang",s.EN)})}):$("i.UT").each(function(t,e){return $(e).text($(e).attr("en-text")||$(e).text().trim())}).attr("lang",e)}}]),t}();var v=e.appSettings=new p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a,i,o,s,l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=Object.freeze({SI:"si",HI:"hi",RO:"ro",THAI:"th",LAOS:"lo",MY:"my",KM:"km",BENG:"be",GURM:"gm",THAM:"tt",GUJA:"gj",TELU:"te",KANN:"ka",MALA:"mm",BRAH:"br",TIBT:"tb",CYRL:"cy"}),h=new Map([[f.SI,["Sinhala","සිංහල",[[3456,3583]],{f:"sl_flag.png"}]],[f.HI,["Devanagari","हिन्दी",[[2304,2431]],{f:"in_flag.png"}]],[f.RO,["Roman","Roman",[[0,383],[7680,7935]],{f:"uk_flag.png"}]],[f.THAI,["Thai","ไทย",[[3584,3711]],{f:"th_flag.png"}]],[f.LAOS,["Laos","ລາວ",[[3712,3839]],{f:"laos_flag.png"}]],[f.MY,["Myanmar","ဗမာစာ",[[4096,4223]],{f:"my_flag.png"}]],[f.KM,["Khmer","ភាសាខ្មែរ",[[6016,6143]],{f:"kh_flag.png"}]],[f.BENG,["Bengali","বাংলা",[[2432,2559]],{f:"bangla_flag.png"}]],[f.GURM,["Gurmukhi","ਗੁਰਮੁਖੀ",[[2560,2687]],{}]],[f.THAM,["Tai Tham","Tai Tham LN",[[6688,6831]],{c:"beta-script"}]],[f.GUJA,["Gujarati","ગુજરાતી",[[2688,2815]],{}]],[f.TELU,["Telugu","తెలుగు",[[3072,3199]],{}]],[f.KANN,["Kannada","ಕನ್ನಡ",[[3200,3327]],{}]],[f.MALA,["Malayalam","മലയാളം",[[3328,3455]],{}]],[f.BRAH,["Brahmi","Brāhmī",[[55300,55300],[56320,56447]],{}]],[f.TIBT,["Tibetan","བོད་སྐད།",[[3840,4095]],{f:"tibet_flag.png",c:"larger"}]],[f.CYRL,["Cyrillic","кириллица",[[1024,1279],[768,879]],{f:"russia_flag.png"}]]]);function p(t){var e=!0,n=!1,r=void 0;try{for(var a,i=h[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value,s=!0,l=!1,c=void 0;try{for(var u,f=o[1][2][Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value;if(t>=p[0]&&t<=p[1])return o[0]}}catch(t){l=!0,c=t}finally{try{!s&&f.return&&f.return()}finally{if(l)throw c}}}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}return-1}var g=(u(r={},f.SI,0),u(r,f.HI,1),u(r,f.RO,2),u(r,f.THAI,3),u(r,f.LAOS,4),u(r,f.MY,5),u(r,f.KM,6),u(r,f.BENG,7),u(r,f.GURM,8),u(r,f.THAM,9),u(r,f.GUJA,10),u(r,f.TELU,11),u(r,f.KANN,12),u(r,f.MALA,13),u(r,f.BRAH,14),u(r,f.TIBT,15),u(r,f.CYRL,16),r),d=[["අ","अ","a","อ","ອ","အ","អ","অ","ਅ","ᩋ","અ","అ","ಅ","അ","𑀅","ཨ","а"],["ආ","आ","ā","อา","ອາ","အာ","អា","আ","ਆ","ᩌ","આ","ఆ","ಆ","ആ","𑀆","ཨཱ","аа"],["ඉ","इ","i","อิ","ອິ","ဣ","ឥ","ই","ਇ","ᩍ","ઇ","ఇ","ಇ","ഇ","𑀇","ཨི","и"],["ඊ","ई","ī","อี","ອີ","ဤ","ឦ","ঈ","ਈ","ᩎ","ઈ","ఈ","ಈ","ഈ","𑀈","ཨཱི","ий"],["උ","उ","u","อุ","ອຸ","ဥ","ឧ","উ","ਉ","ᩏ","ઉ","ఉ","ಉ","ഉ","𑀉","ཨུ","у"],["ඌ","ऊ","ū","อู","ອູ","ဦ","ឩ","ঊ","ਊ","ᩐ","ઊ","ఊ","ಊ","ഊ","𑀊","ཨཱུ","уу"],["එ","ए","e","เอ","ເອ","ဧ","ឯ","এ","ਏ","ᩑ","એ","ఏ","ಏ","ഏ","𑀏","ཨེ","з"],["ඔ","ओ","o","โอ","ໂອ","ဩ","ឱ","ও","ਓ","ᩒ","ઓ","ఓ","ಓ","ഓ","𑀑","ཨོ","о"],["ං","ं","ṃ","ํ","ໍ","ံ","ំ","ং","ਂ","ᩴ","ં","ం","ಂ","ം","𑀁","ཾ","м̣"],["ඃ","ः","ḥ","ะ","ະ","း","ះ","ঃ","ਃ","ᩡ","ઃ","ః","ಃ","ഃ","𑀂","ཿ","х̣"],["්","्","","ฺ","຺","္","្","্","੍","᩠","્","్","್","്","𑁆","྄",""],["0","०","0","๐","໐","၀","០","০","੦","᪐","૦","౦","೦","൦","𑁦","༠","0"],["1","१","1","๑","໑","၁","១","১","੧","᪑","૧","౧","೧","൧","𑁧","༡","1"],["2","२","2","๒","໒","၂","២","২","੨","᪒","૨","౨","೨","൨","𑁨","༢","2"],["3","३","3","๓","໓","၃","៣","৩","੩","᪓","૩","౩","೩","൩","𑁩","༣","3"],["4","४","4","๔","໔","၄","៤","৪","੪","᪔","૪","౪","೪","൪","𑁪","༤","4"],["5","५","5","๕","໕","၅","៥","৫","੫","᪕","૫","౫","೫","൫","𑁫","༥","5"],["6","६","6","๖","໖","၆","៦","৬","੬","᪖","૬","౬","೬","൬","𑁬","༦","6"],["7","७","7","๗","໗","၇","៧","৭","੭","᪗","૭","౭","೭","൭","𑁭","༧","7"],["8","८","8","๘","໘","၈","៨","৮","੮","᪘","૮","౮","೮","൮","𑁮","༨","8"],["9","९","9","๙","໙","၉","៩","৯","੯","᪙","૯","౯","೯","൯","𑁯","༩","9"]],v=[["ක","क","k","ก","ກ","က","ក","ক","ਕ","ᨠ","ક","క","ಕ","ക","𑀓","ཀ","г"],["ඛ","ख","kh","ข","ຂ","ခ","ខ","খ","ਖ","ᨡ","ખ","ఖ","ಖ","ഖ","𑀔","ཁ","к"],["ග","ग","g","ค","ຄ","ဂ","គ","গ","ਗ","ᨣ","ગ","గ","ಗ","ഗ","𑀕","ག","г̇"],["ඝ","घ","gh","ฆ","ຆ","ဃ","ឃ","ঘ","ਘ","ᨥ","ઘ","ఘ","ಘ","ഘ","𑀖","གྷ","гх"],["ඞ","ङ","ṅ","ง","ງ","င","ង","ঙ","ਙ","ᨦ","ઙ","ఙ","ಙ","ങ","𑀗","ང","н̇"],["ච","च","c","จ","ຈ","စ","ច","চ","ਚ","ᨧ","ચ","చ","ಚ","ച","𑀘","ཙ","ж"],["ඡ","छ","ch","ฉ","ຉ","ဆ","ឆ","ছ","ਛ","ᨨ","છ","ఛ","ಛ","ഛ","𑀙","ཚ","ч"],["ජ","ज","j","ช","ຊ","ဇ","ជ","জ","ਜ","ᨩ","જ","జ","ಜ","ജ","𑀚","ཛ","ж̇"],["ඣ","झ","jh","ฌ","ຌ","ဈ","ឈ","ঝ","ਝ","ᨫ","ઝ","ఝ","ಝ","ഝ","𑀛","ཛྷ","жх"],["ඤ","ञ","ñ","ญ","ຎ","ဉ","ញ","ঞ","ਞ","ᨬ","ઞ","ఞ","ಞ","ഞ","𑀜","ཉ","н̃"],["ට","ट","ṭ","ฏ","ຏ","ဋ","ដ","ট","ਟ","ᨭ","ટ","ట","ಟ","ട","𑀝","ཊ","д"],["ඨ","ठ","ṭh","ฐ","ຐ","ဌ","ឋ","ঠ","ਠ","ᨮ","ઠ","ఠ","ಠ","ഠ","𑀞","ཋ","т"],["ඩ","ड","ḍ","ฑ","ຑ","ဍ","ឌ","ড","ਡ","ᨯ","ડ","డ","ಡ","ഡ","𑀟","ཌ","д̣"],["ඪ","ढ","ḍh","ฒ","ຒ","ဎ","ឍ","ঢ","ਢ","ᨰ","ઢ","ఢ","ಢ","ഢ","𑀠","ཌྷ","дх"],["ණ","ण","ṇ","ณ","ຓ","ဏ","ណ","ণ","ਣ","ᨱ","ણ","ణ","ಣ","ണ","𑀡","ཎ","н̣"],["ත","त","t","ต","ຕ","တ","ត","ত","ਤ","ᨲ","ત","త","ತ","ത","𑀢","ཏ","д̇"],["ථ","थ","th","ถ","ຖ","ထ","ថ","থ","ਥ","ᨳ","થ","థ","ಥ","ഥ","𑀣","ཐ","т̇"],["ද","द","d","ท","ທ","ဒ","ទ","দ","ਦ","ᨴ","દ","ద","ದ","ദ","𑀤","ད","д̣̇"],["ධ","ध","dh","ธ","ຘ","ဓ","ធ","ধ","ਧ","ᨵ","ધ","ధ","ಧ","ധ","𑀥","དྷ","д̇х"],["න","न","n","น","ນ","န","ន","ন","ਨ","ᨶ","ન","న","ನ","ന","𑀦","ན","н"],["ප","प","p","ป","ປ","ပ","ប","প","ਪ","ᨸ","પ","ప","ಪ","പ","𑀧","པ","б"],["ඵ","फ","ph","ผ","ຜ","ဖ","ផ","ফ","ਫ","ᨹ","ફ","ఫ","ಫ","ഫ","𑀨","ཕ","п"],["බ","ब","b","พ","ພ","ဗ","ព","ব","ਬ","ᨻ","બ","బ","ಬ","ബ","𑀩","བ","б̣"],["භ","भ","bh","ภ","ຠ","ဘ","ភ","ভ","ਭ","ᨽ","ભ","భ","ಭ","ഭ","𑀪","བྷ","бх"],["ම","म","m","ม","ມ","မ","ម","ম","ਮ","ᨾ","મ","మ","ಮ","മ","𑀫","མ","м"],["ය","य","y","ย","ຍ","ယ","យ","য","ਯ","ᨿ","ય","య","ಯ","യ","𑀬","ཡ","я"],["ර","र","r","ร","ຣ","ရ","រ","র","ਰ","ᩁ","ર","ర","ರ","ര","𑀭","ར","р"],["ල","ल","l","ล","ລ","လ","ល","ল","ਲ","ᩃ","લ","ల","ಲ","ല","𑀮","ལ","л"],["ළ","ळ","ḷ","ฬ","ຬ","ဠ","ឡ","ল়","ਲ਼","ᩊ","ળ","ళ","ಳ","ള","𑀴","ལ༹","л̣"],["ව","व","v","ว","ວ","ဝ","វ","ৰ","ਵ","ᩅ","વ","వ","ವ","വ","𑀯","ཝ","в"],["ස","स","s","ส","ສ","သ","ស","স","ਸ","ᩈ","સ","స","ಸ","സ","𑀲","ས","с"],["හ","ह","h","ห","ຫ","ဟ","ហ","হ","ਹ","ᩉ","હ","హ","ಹ","ഹ","𑀳","ཧ","х"]],y=[["ා","ा","ā","า","າ","ာ","ា","া","ਾ","ᩣ","ા","ా","ಾ","ാ","𑀸","ཱ","аа"],["ි","ि","i","ิ","ິ","ိ","ិ","ি","ਿ","ᩥ","િ","ి","ಿ","ി","𑀺","ི","и"],["ී","ी","ī","ี","ີ","ီ","ី","ী","ੀ","ᩦ","ી","ీ","ೀ","ീ","𑀻","ཱི","ий"],["ු","ु","u","ุ","ຸ","ု","ុ","ু","ੁ","ᩩ","ુ","ు","ು","ു","𑀼","ུ","у"],["ූ","ू","ū","ู","ູ","ူ","ូ","ূ","ੂ","ᩪ","ૂ","ూ","ೂ","ൂ","𑀽","ཱུ","уу"],["ෙ","े","e","เ","ເ","ေ","េ","ে","ੇ","ᩮ","ે","ే","ೇ","േ","𑁂","ེ","з"],["ො","ो","o","โ","ໂ","ော","ោ","ো","ੋ","ᩮᩣ","ો","ో","ೋ","ോ","𑁄","ོ","о"]];function k(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"cen"==n?t=t.replace(/॥/g,""):n.startsWith("ga")&&(t=(t=t.replace(/।/g,";")).replace(/॥/g,".")),t=(t=(t=(t=t.replace(/॰…/g,"…")).replace(/॰/g,"·")).replace(/[।॥]/g,".")).replace(/\s([\s,!;\?\.])/g,"$1")}function b(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e==f.THAI?t.replace(/([ก-ฮ])([เโ])/g,"$2$1"):e==f.LAOS?t.replace(/([ກ-ຮ])([ເໂ])/g,"$2$1"):void console.error("Unsupported script "+e+" for swap_e_o method.")}function m(t,e){return e==f.THAI?t.replace(/([เโ])([ก-ฮ])/g,"$2$1"):e==f.LAOS?t.replace(/([ເໂ])([ກ-ຮ])/g,"$2$1"):void 0}function T(t){return t.replace(/\u200C|\u200D/g,"")}var S=[],C=(u(a={},f.SI,[function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],t.replace(/\u0DCA([\u0DBA\u0DBB])/g,"්‍$1")},k]),u(a,f.RO,[k,function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],(t=(t=t.replace(/^(\S)/g,function(t,e){return e.toUpperCase()})).replace(/([\.\?]\s)(\S)/g,function(t,e,n){return""+e+n.toUpperCase()})).replace(/([\u201C‘])(\S)/g,function(t,e,n){return""+e+n.toUpperCase()})}]),u(a,f.THAI,[b,k]),u(a,f.LAOS,[b,k]),u(a,f.MY,[function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/[,;]/g,"၊")).replace(/[\u2026\u0964\u0965]+/g,"။")).replace(/ဉ\u1039ဉ/g,"ည")).replace(/သ\u1039သ/g,"ဿ")).replace(/င္([က-ဠ])/g,"င်္$1")).replace(/္ယ/g,"ျ")).replace(/္ရ/g,"ြ")).replace(/္ဝ/g,"ွ")).replace(/္ဟ/g,"ှ")).replace(/([ခဂဒပဝ](:?္[က-ဠ])?ေ?)ာ/g,"$1ါ")},k]),u(a,f.KM,[k]),u(a,f.THAM,[function(t){return(t=(t=(t=t.replace(/\u1A60\u1A41/g,"ᩕ")).replace(/\u1A48\u1A60\u1A48/g,"ᩔ")).replace(/।/g,"᪨")).replace(/॥/g,"᪩")}]),u(a,f.GUJA,[k]),u(a,f.TELU,[k]),u(a,f.MALA,[k]),u(a,f.BRAH,[function(t){return(t=(t=t.replace(/।/g,"𑁇")).replace(/॥/g,"𑁈")).replace(/–/g,"𑁋")},k]),u(a,f.TIBT,[function(t){t=(t=t.replace(/।/g,"།")).replace(/॥/g,"༎");for(var e=0;e<=39;e++)t=t.replace(new RegExp(String.fromCharCode(3972,3904+e),"g"),String.fromCharCode(3984+e));return(t=(t=(t=(t=t.replace(/\u0F61\u0FB1/g,"ཡྻ")).replace(/\u0F5D\u0FAD/g,"ཝྺ")).replace(/\u0F5B\u0FAC/g,"ཛ྄ཛྷ")).replace(/\u0F61\u0FB7/g,"ཡ྄ཧ")).replace(/\u0F5D\u0FB7/g,"ཝ྄ཧ")}]),u(a,f.CYRL,[k]),a),w=[],$=(u(i={},f.SI,[T]),u(i,f.HI,[T]),u(i,f.RO,[function(t){return t.toLowerCase()}]),u(i,f.THAI,[m]),u(i,f.LAOS,[m]),u(i,f.MY,[function(t){return(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\u102B/g,"ာ")).replace(/ှ/g,"္ဟ")).replace(/ွ/g,"္ဝ")).replace(/ြ/g,"္ရ")).replace(/ျ/g,"္ယ")).replace(/\u103A/g,"")).replace(/ဿ/g,"သ္သ")).replace(/ည/g,"ဉ္ဉ")).replace(/၊/g,",")).replace(/။/g,".")}]),u(i,f.TIBT,[function(t){return t}]),i);function P(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[[],[],[]];return v.concat(d,n?y:[]).forEach(function(n){n[t]&&r[n[t].length-1].push([n[t],n[e]])}),r.filter(function(t){return t.length}).map(function(t){return[t[0][0].length,new Map(t)]}).reverse()}function x(t,e){for(var n=new Array,r=0;r<t.length;){var a=!1,i=!0,o=!1,s=void 0;try{for(var l,u=e[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var f=l.value,h=c(f,2),p=h[0],g=h[1],d=t.substr(r,p);if(g.has(d)){n.push(g.get(d)),a=!0,r+=p;break}}}catch(t){o=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw s}}a||(n.push(t.charAt(r)),r++)}return n.join("")}function I(t,e){var n=e==f.CYRL?"а":"a";return(t=(t=t.replace(new RegExp("([ක-ෆ])([^ා-ෟ්"+n+"])","g"),"$1"+n+"$2")).replace(new RegExp("([ක-ෆ])([^ා-ෟ්"+n+"])","g"),"$1"+n+"$2")).replace(/([ක-ෆ])$/g,"$1"+n)}var L={"අ":"","ආ":"ා","ඉ":"ි","ඊ":"ී","උ":"ු","ඌ":"ූ","එ":"ෙ","ඔ":"ො"};function A(t,e){return t=(t=(t=t.replace(/([ක-ෆ])([^අආඉඊඋඌඑඔ])/g,"$1්$2")).replace(/([ක-ෆ])$/g,"$1්")).replace(/([ක-ෆ])([අආඉඊඋඌඑඔ])/g,function(t,e,n){return e+L[n]})}var O=[j],E=(u(o={},f.SI,[]),u(o,f.RO,[I,j]),u(o,f.CYRL,[I,j]),o),M=[function(t,e){var n=P(g[e],g[f.SI]);return x(t,n)}],R=(u(s={},f.SI,[]),u(s,f.RO,[F,A]),u(s,f.CYRL,[F,A]),s);function j(t,e){return x(t,P(g[f.SI],g[e]))}function F(t,e){return x(t,P(g[e],g[f.SI],!1))}var N=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return l(t,null,[{key:"basicConvert",value:function(t,e){return(E[e]||O).forEach(function(n){return t=n(t,e)}),t}},{key:"basicConvertFrom",value:function(t,e){return(R[e]||M).forEach(function(n){return t=n(t,e)}),t}},{key:"beautify",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return(C[e]||S).forEach(function(r){return t=r(t,e,n)}),t}},{key:"convert",value:function(t,e){return t=this.basicConvert(t,e),this.beautify(t,e)}},{key:"convertFrom",value:function(t,e){return($[e]||w).forEach(function(n){return t=n(t,e)}),this.basicConvertFrom(t,e)}},{key:"convertFromMixed",value:function(t){t=T(t)+" ";for(var e=-1,n="",r="",a=0;a<t.length;a++){var i=p(t.charCodeAt(a));i!=e||a==t.length-1?(console.log('process run: "'+n+'", i: '+a+", script: "+e),r+=this.convertFrom(n,e),e=i,n=t.charAt(a)):n+=t.charAt(a)}return r}}]),t}();e.TextProcessor=N,e.Script=f,e.paliScriptInfo=h,e.getScriptForCode=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitakaTree=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0);var i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.treeJson={},this.collections=[],this.fileIdToColl={}}return r(t,[{key:"initialize",value:function(t){var e=this;return this.appTabs=t,$.getJSON("../static/json/full-tree.json",function(t){e.treeJson=t,e.createCollections(e.treeJson,-1),e.root.append(e.createSubtree(e.treeJson,["m"],"tree-mul")),e.root.append(e.createSubtree(e.treeJson,["a"],"tree-att")),e.root.append(e.createSubtree(e.treeJson,["t","ta"],"tree-tik")),e.root.append(e.createSubtree(e.treeJson[3].c,["e"],"tree-e")),e.registerClick(),console.log("Tree loaded. num collections: "+e.collections.length+", num fileIds: "+Object.keys(e.fileIdToColl).length)}).fail(function(t,e,n){console.error("getJSON failed, status: "+e+", error: "+n)})}},{key:"createSubtree",value:function(t,e,n,r){var i=this,o=$("<ul/>").attr("id",n);return t.forEach(function(t){if(t.c){var n=!0,s=!1,l=void 0;try{for(var c,u=e[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var f=c.value;if(t[f]){var h=$("<a/>").append((0,a.PT)(t[f]));$("<li/>").append(h).addClass("parent").append(i.createSubtree(t.c,e,"",f)).appendTo(o)}}}catch(t){s=!0,l=t}finally{try{!n&&u.return&&u.return()}finally{if(s)throw l}}}else if(t["f"+r]){var p=$("<a/>").append((0,a.PT)(t[r])),g=t["f"+r];$("<li/>").append(p).attr("file-id",g).appendTo(o)}}),o}},{key:"addCollection",value:function(t,e){var n=this,r=this.collections.length,a={id:r,p:e,n:[]};return Object.keys(t).forEach(function(e){if("c"!=e&&!e.startsWith("f")){var i=t["f"+e];i?(a.n.push([e,t[e],i]),n.fileIdToColl[i]=r):a.n.push([e,t[e]])}}),this.collections.push(a),r}},{key:"createCollections",value:function(t,e){var n=this;t.forEach(function(t){t.c?n.createCollections(t.c,n.addCollection(t,e)):n.addCollection(t,e)})}},{key:"changeScript",value:function(){(0,a.PT_REFRESH)(this.root)}},{key:"registerClick",value:function(){var e=this;this.root.on("click","li > a",function(n){var r=$(n.currentTarget).parent();if(r.hasClass("parent"))e.toggleBranch(r);else if(r.attr("file-id")){var a=r.attr("file-id"),i=e.getCollection(a),o=t.filterCollection(i,a);e.appTabs.newTab(a,o[1],i)}})}},{key:"getCollection",value:function(t){return this.collections[this.fileIdToColl[t]]}},{key:"toggleBranch",value:function(t){t.toggleClass("active").children("ul").slideToggle("fast")}},{key:"showBranch",value:function(t){t.addClass("active").children("ul").slideDown("fast")}},{key:"collapse",value:function(){$("li.parent.active",this.root).removeClass("active").children("ul").slideUp("fast")}},{key:"openBranch",value:function(t){var e=this;this.collapse(),$("li[file-id="+t+"]",this.root).parents("li").each(function(t,n){return e.showBranch($(n))})}}],[{key:"filterCollection",value:function(t,e){return t.n.filter(function(t){return t[0]==e||t[2]==e})[0]}}]),t}();e.PitakaTree=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vManager=e.PitakaTabs=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),i=n(8);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.PitakaTabs=function(){function t(e,n){o(this,t),this.root=e,this.appTree=n,this.tabs=new Map,this.files=new Map,this.activeTabId="",this.currentView=a.appSettings.get("tabViewFormat"),this.heads=$("div.tab-heads",this.root),this.contents=$("div.tab-contents",this.root),this.heads.add(this.contents).attr("view",this.currentView),this.registerClicks()}return r(t,[{key:"registerClicks",value:function(){var t=this;this.heads.on("click",".tab-head",function(e){t.showTab($(e.currentTarget).attr("tab-id"))}),this.heads.on("click",".close-icon",function(e){t.removeTab($(e.currentTarget).parent().attr("tab-id")),e.stopPropagation()})}},{key:"showTab",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!!this.tabs.has(t)&&(this.tabs.forEach(function(t){return t.forEach(function(t){return t.removeClass("active")})}),this.tabs.get(t).forEach(function(t){return t.addClass("active")}),this.files.get(t).openAndHighlightLine(e),this.activeTabId=t,!0)}},{key:"removeTab",value:function(t){if(console.log(t),!this.tabs.has(t)||this.tabs.size<=1)return!1;this.tabs.get(t).forEach(function(t){return t.remove()}),this.tabs.delete(t),this.files.delete(t),this.activeTabId==t&&this.showTab(this.tabs.keys().next().value)}},{key:"newTab",value:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c.showPane("text");var l=s(),u=(0,a.PT)(n.replace(/^[\(\)\d+\s\-\.]+/,"")),f=$("<span/>").append(u).addClass("head-label"),h=$("<span/>").addClass("close-icon far fa-times"),p=t.getCollIcon(e,r),g=$("<div/>").addClass("tab-head").append(p,f,h).appendTo(this.heads),d=$("<div/>").addClass("tab-content").appendTo(this.contents);g.add(d).attr("view",this.currentView).attr("file-id",e).attr("tab-id",l);var v=new i.FileDisplay(d,this,e,r,o);v.load(),this.tabs.set(l,[g,d]),this.files.set(l,v),this.showTab(l)}},{key:"changeScript",value:function(){if(0!=this.tabs.size){var t=this.tabs.get(this.activeTabId)[0];(0,a.PT_REFRESH)(t),this.files.get(this.activeTabId).changeScript()}}},{key:"changeTextFormat",value:function(){this.files.forEach(function(t){return t.refresh()})}},{key:"getNumTabs",value:function(){return this.tabs.size}},{key:"switchView",value:function(){this.currentView="tabbed"==this.currentView?"columns":"tabbed",a.appSettings.set("tabViewFormat",this.currentView),$(".tab-content,.tab-head").add(this.heads,this.contents).attr("view",this.currentView)}}],[{key:"getCollIcon",value:function(t,e){var n=e.n.find(function(e){return e[2]==t})[0].charAt(0).toUpperCase();return $("<span/>").addClass(n).addClass("coll-icon").text(n)}}]),t}();var s=function(){return"id-"+Math.floor(1e6*Math.random())};var l=function(){function t(){o(this,t),this.curPane=this.prevPane="",this.registerEvents(),this.showPane("settings")}return r(t,[{key:"showPane",value:function(t){"back"==t&&(t=this.prevPane),t&&$("div.top-pane").hide(),"text"==t?$("#text-view-area").show():"settings"==t?$("#settings-area").show():"search"==t?$("#search-area").show():"bookmarks"==t&&$("#bookmarks-area").show(),this.prevPane=this.curPane,this.curPane=t}},{key:"registerEvents",value:function(){var t=this;$("#settings-button").click(function(e){return t.showPane("settings")}),$("#text-view-button").click(function(e){return t.showPane("text")}),$(".search-bar").focus(function(e){return t.showPane("search")}),$("#menu-toggle").mousedown(function(t){$("#menu-list").animate({height:"toggle"},200),t.stopPropagation()}),$("#tree-toggle").mousedown(function(t){$(".pitaka-tree-container").animate({width:"toggle"},250),$(".pitaka-tree-container").toggleClass("user-opened"),t.stopPropagation()}),$("#menu-list, .pitaka-tree-container").mousedown(function(t){t.stopPropagation()}),$("body").mousedown(function(){$("#menu-list").animate({height:"hide"},350),"absolute"==$(".pitaka-tree-container").css("position")&&$(".pitaka-tree-container").animate({width:"hide"},250)})}}]),t}(),c=e.vManager=new l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinkHandler=e.Collection=e.Note=e.PageTag=void 0;var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(1),o=n(0),s=n(2),l=n(5);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=new Map([["T","Thai"],["M","Myanmar"],["V","VRI"],["P","PTS"]]);e.PageTag=function(){function t(){c(this,t)}return a(t,null,[{key:"render",value:function(e){"none"==o.appSettings.get("pageTagFormat")?e.children("pb").remove():e.children("pb").each(function(e,n){return t.getPageTagDisplay($(n))})}},{key:"getPageTagDisplay",value:function(t){var e=void 0,n=void 0,r=!0,a=!1,i=void 0;try{for(var s,l=u[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;if(n=t.attr(c[0])){e=c;break}}}catch(t){a=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}var f=(n=n.split("."))[0]?n[0]+".":"";"click"==o.appSettings.get("pageTagFormat")?t.text("¶").addClass("click"):"short"==o.appSettings.get("pageTagFormat")?t.text("["+e[0]+": "+f+n[1]+"]"):t.html("[<i>"+e[1]+"</i> "+f+n[1]+"]"),t.addClass(e[0])}}]),t}(),e.Note=function(){function t(){c(this,t)}return a(t,null,[{key:"render",value:function(t){"none"==o.appSettings.get("footnoteFormat")?t.children("n").remove():"click"==o.appSettings.get("footnoteFormat")?t.children("n").each(function(t,e){$(e).attr("text",$(e).text()).empty().addClass("click")}):t.children("n").each(function(t,e){return $(e).text("["+$(e).text()+"]")})}},{key:"showNoteBox",value:function(t){var e=$(t.currentTarget);alert(e.attr("text"))}}]),t}(),e.Collection=function(){function t(e,n,r,a){c(this,t),this.collObj=e,this.root=n,this.fileId=r,this.tabs=a,this.registerClicks()}return a(t,[{key:"registerClicks",value:function(){var t=this;this.root.on("click",".coll-button",function(e){var n=s.PitakaTree.filterCollection(t.collObj,$(e.currentTarget).attr("na"));console.log(n),t.tabs.newTab(n[2],n[1],t.collObj)})}},{key:"renderTop",value:function(){var t=this;this.buttons=$('<div class="coll-buttons top"/>').appendTo(this.root),this.collObj.n.filter(function(e){return e[2]!=t.fileId}).forEach(function(e){var n=e[0].toUpperCase();$('<span class="coll-button '+n.charAt(0)+'" na="'+n.toLowerCase()+'">'+n+"</span>").appendTo(t.buttons)})}},{key:"renderOnClick",value:function(){}}]),t}(),e.LinkHandler=function(){function t(e){c(this,t),this.fileDisplay=e,this.root=this.fileDisplay.root,this.registerClicks()}return a(t,[{key:"registerClicks",value:function(){}},{key:"openAndHighlightLine",value:function(t){if(t){var e=this.root.children("[line-ind="+t+"]").first();if(e){e.css("background-color","lightyellow");var n=e.attr("class").split(" ")[0],r=e;$.inArray(n,["bod","gax","gae"])>=0&&(r=e.prevAll("[tt]").first()),r.hasClass("open")||this.fileDisplay.openTitleDiv(r),this.fileDisplay.scrollToDiv(e)}}}}],[{key:"initClipboard",value:function(){new ClipboardJS(".share-icon",{text:function(e){var n=$(e),r=n.parents(".tab-content"),a=n.parents("[line-ind]").first().attr("line-ind");return t.createLink(r.attr("file-id"),a,r.attr("script"))}}).on("success",function(t){return l.Util.showToast((0,o.UT)(o.stringResources["copy-link"]))})}},{key:"createLink",value:function(t,e,n){return"https://tipitaka.app/?a="+t+"-"+e+"-"+n}},{key:"tryStartupLocation",value:function(t,e){var n=l.Util.getParameterByName("a","").split("-");if(!n)return!1;var a=r(n,3),c=a[0],u=a[1],f=a[2];if(f&&i.Script[f]&&"default"==o.appSettings.paliScriptSource&&o.appSettings.set("paliScript",f),$.isNumeric(u)||(u=0),c&&!t.fileIdToColl[c])showToast("Can not open direct link. Malformed file id "+c);else if(c){var h=t.getCollection(c),p=s.PitakaTree.filterCollection(h,c);return t.openBranch(c),e.newTab(c,p[1],h,Number(u)),!0}return!1}}]),t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,null,[{key:"copyText",value:function(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}},{key:"showToast",value:function(t){var e=$("#toast").html(t).fadeIn(300);setTimeout(function(){e.fadeOut()},3e3)}},{key:"getParameterByName",value:function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===n?e:decodeURIComponent(n[1].replace(/\+/g," "))}},{key:"createLanguageSelectOption",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"./static/images/",r=$("<span/>").addClass("UT").text(e[1]).attr("lang",t),a=e[3].f?$("<img/>").attr("src",""+n+e[3].f):"",i=$("<div/>").addClass("option").append(r,a).attr("value",t);return e[3].c&&i.addClass(e[3].c),i}}]),t}();e.Util=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bookmarks=e.TitleSearch=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(1),i=n(0),o=n(2),s=n(3);function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var c=function(){function t(e,n,r){l(this,t),this.name=e,this.dataUrl=n,this.version=r,this.data=[],this.topParentsInfo=[]}return r(t,[{key:"init",value:function(){var t=this,e=$.Deferred();return this.version==localStorage.getItem("version_"+this.name)&&this.getLocalData(e)||this.loadUrlData(e),e.done(function(){t.data.forEach(function(e){e[f.parents].length||t.topParentsInfo.push([e[f.id],e[f.name]])})}),e}},{key:"getLocalData",value:function(t){var e=localStorage.getItem(this.name);return e?(this.data=JSON.parse(LZString.decompressFromUTF16(e)),console.log(this.name+" loaded of length "+this.data.length+" from local storage."),t.resolve(this.name,this.version),!0):(console.log("no data in storage for "+this.name),!1)}},{key:"loadUrlData",value:function(t){var e=this;$.getJSON(this.dataUrl).done(function(n){e.data=n,t.resolve(e.name,e.version);var r=JSON.stringify(e.data),a=LZString.compressToUTF16(r);try{localStorage.setItem(e.name,a),console.log("Stored data of length "+a.length+" to local storage. Uncompressed length "+r.length),localStorage.setItem("version_"+e.name,e.version)}catch(t){console.error("Failed to set "+e.name+" of size "+a.length+" to local storage "+t)}}).fail(function(n){t.reject("Failed to load the "+e.name+". Please check your internet connection")})}}]),t}(),u=function(){function t(e,n,r,a){var i=this;l(this,t),this.root=e,this.topParentsInfo=n,this.cbObj=a,this.filter=new Map,r.forEach(function(t){return i.filter.set(t,1)}),this.render(),this.registerClicks()}return r(t,[{key:"render",value:function(){var t=this;this.table=$("<table/>").addClass("filter-table").appendTo(this.root),console.log(this.topParentsInfo),[0,1,2].forEach(function(e){var n=$("<tr/>").attr("row",e).appendTo(t.table);[0,1,2].forEach(function(r){var a=t.topParentsInfo[3*r+e];t.renderCheckBox(a[f.id],a[f.name],e,r).appendTo(n)})});var e=this.renderCheckBox(this.topParentsInfo[9][f.id],this.topParentsInfo[9][f.name],3,0).attr("colspan",3);$("<tr/>").attr("row",3).append(e).appendTo(this.table)}},{key:"renderCheckBox",value:function(t,e,n,r){return $("<td/>").html((0,i.PT)(e)).attr("row",n).attr("column",r).attr("value",t).toggleClass("checked",this.filter.has(t))}},{key:"registerClicks",value:function(){var t=this;this.table.on("click","td",function(e){var n=$(e.currentTarget).toggleClass("checked");n.hasClass("checked")?t.filter.set(Number(n.attr("value")),1):t.filter.delete(Number(n.attr("value"))),t.cbObj.filterChanged(Array.from(t.filter.keys()))})}}]),t}(),f=Object.freeze({id:0,name:1,type:2,parents:3,file:4,lineInd:5}),h=new c("title-index","./static/json/title-search-index.json","2.0"),p=e.TitleSearch=function(){function t(e,n,r){l(this,t),this.root=e,this.tree=n,this.tabs=r,this.searchPrevQuery="",this.searchCache=new Map,this.settings={minQueryLength:2,maxResults:100}}return r(t,[{key:"init",value:function(){var t=this;return h.init().done(function(e,n){t.filterParents=i.appSettings.get("title-search-filter"),t.filterParents||(t.filterParents=h.topParentsInfo.slice(0,-1).map(function(t){return t[0]}),i.appSettings.set("title-search-filter",t.filterParents)),t.filter=new u($("#search-filter"),h.topParentsInfo,t.filterParents,t),t.registerClicks(),console.log("search index loaded with length "+h.data.length+", version: "+n)}).fail(function(t){})}},{key:"registerClicks",value:function(){var e=this;$(".search-bar").on("keyup compositionend",function(t){return e.performSearch(t)}),$("#search-filter-button").click(function(t){return $("#search-filter").slideToggle("fast")}),$("#search-results").on("click","i.name",function(n){return t.openResult(n,e.tree,e.tabs)})}},{key:"performSearch",value:function(t){t.stopPropagation(),s.vManager.showPane("search");var e=a.TextProcessor.convertFromMixed($(".search-bar").val());if(e!=this.searchPrevQuery)if($("#search-results",this.root).empty(),this.searchPrevQuery=e,e.length<this.settings.minQueryLength)this.setStatus("Please enter some more characters to start the searching. Minimum: "+this.settings.minQueryLength);else{console.log("starting the search with query "+e);var n=this.searchIndex(e);this.displayResults(n)}}},{key:"checkQuery",value:function(t,e){return e.exec(t[f.name])&&(this.filterParents.length==h.topParentsInfo.length||this.filterParents.indexOf(t[f.parents][0])>=0)}},{key:"searchIndex",value:function(t){if(this.searchCache.has(t)){var e=this.searchCache.get(t);return console.log("Results for query "+t+" found in cache of length "+e.length),e}for(var n=new RegExp(t,"i"),r=[],a=0;a<h.data.length&&(this.checkQuery(h.data[a],n)&&r.push(a),!(r.length>=this.settings.maxResults));a++);return console.log("Search for "+t+" in index found "+r.length+" hits"),this.searchCache.set(t,r),r}},{key:"setStatus",value:function(t){$("#search-status",this.root).empty().append((0,i.UT)(t))}},{key:"displayResults",value:function(e){var n=$("#search-results",this.root).empty();e?(n.append(t.createResultsList(e)),n.show(),e.length<this.settings.maxResults?this.setStatus("The number of entries found for your search term "+e.length):this.setStatus("Too many results found. Number of results shown "+this.settings.maxResults)):this.setStatus("Your search term did not return any results. Please try another term.")}},{key:"changeScript",value:function(){(0,i.PT_REFRESH)(this.root)}},{key:"filterChanged",value:function(t){this.filterParents=t,i.appSettings.set("title-search-filter",this.filterParents),console.log(t),this.searchCache.clear();var e=this.searchIndex(this.searchPrevQuery);this.displayResults(e)}}],[{key:"openResult",value:function(t,e,n){var r=h.data[$(t.currentTarget).attr("index")],a=r[f.file],i=e.getCollection(a),s=o.PitakaTree.filterCollection(i,a);n.newTab(a,s[1],i,Number(r[f.lineInd])),e.openBranch(a)}},{key:"createResultsList",value:function(t){return t.map(function(t){var e=h.data[t],n=$("<div/>").addClass("search-result").attr("index",t);return e[f.parents].forEach(function(t){(0,i.PT)(h.data[t][f.name]).addClass("parent name").attr("index",t).appendTo(n),$("<i/>").text(" » ").appendTo(n)}),(0,i.PT)(e[f.name]).addClass("child name").attr("index",t).appendTo(n),d.getIcon(e[f.file],e[f.lineInd]).appendTo(n),n})}}]),t}(),g=function(){function t(){l(this,t),this.list={}}return r(t,[{key:"init",value:function(t,e){this.tree=t,this.tabs=e;var n=localStorage.getItem("bookmarks");n&&(this.list=JSON.parse(n)),this.registerClicks(),this.updateCount(),this.filterParents=i.appSettings.get("bookmarks-filter"),this.filterParents||(this.filterParents=h.topParentsInfo.map(function(t){return t[0]}),i.appSettings.set("bookmarks-filter",this.filterParents)),this.filter=new u($("#bookmarks-filter"),h.topParentsInfo,this.filterParents,this)}},{key:"registerClicks",value:function(){var t=this;$("body").on("click","i.save-icon",function(e){var n=$(e.currentTarget),r=n.attr("key");t.list[r]?(n.removeClass("saved"),delete t.list[r],console.log("bookmark "+r+" deleted")):(n.addClass("saved"),t.list[r]=Date.now(),console.log("bookmark "+r+" added")),localStorage.setItem("bookmarks",JSON.stringify(t.list)),t.updateCount()}),$("#bookmarks-button").click(function(e){t.renderBookmarks(),s.vManager.showPane("bookmarks")}),$("#bookmarks-filter-button").click(function(t){return $("#bookmarks-filter").slideToggle("fast")}),$("#bookmarks-list").on("click","i.name",function(e){return p.openResult(e,t.tree,t.tabs)})}},{key:"updateCount",value:function(){$("#bookmarks-count").text(Object.keys(this.list).length)}},{key:"getIcon",value:function(t,e){var n=t+","+e;return $("<i/>").addClass("far fa-star save-icon action-icon").toggleClass("saved",this.list[n]>0).attr("key",n)}},{key:"renderBookmarks",value:function(){var t=this,e=$("#bookmarks-list").empty();if(Object.keys(this.list).length){var n=[];h.data.forEach(function(e){var r=e[f.file]+","+e[f.lineInd];t.list[r]&&t.checkFilter(e)&&n.push(e[f.id])}),e.append(p.createResultsList(n)),this.setStatus("The number of bookmarks found matching your filter "+n.length)}else this.setStatus("You have no bookmarks saved. Click the star icon to save to bookmarks.")}},{key:"checkFilter",value:function(t){return this.filterParents.length==h.topParentsInfo.length||this.filterParents.indexOf(t[f.parents][0])>=0}},{key:"filterChanged",value:function(t){this.filterParents=t,i.appSettings.set("bookmarks-filter",this.filterParents),this.renderBookmarks()}},{key:"setStatus",value:function(t){$("#bookmarks-status").empty().append((0,i.UT)(t))}},{key:"changeScript",value:function(){(0,i.PT_REFRESH)($("#bookmarks-area"))}}]),t}(),d=e.bookmarks=new g},function(t,e,n){"use strict";var r=n(0),a=n(3),i=n(2),o=n(4),s=n(6),l=n(5),c=new i.PitakaTree($(".pitaka-tree")),u=new a.PitakaTabs($(".text-section"),c);c.initialize(u).done(function(){o.LinkHandler.initClipboard(),o.LinkHandler.tryStartupLocation(c,u)});var f=new s.TitleSearch($("#search-area"),c,u);f.init().done(function(){s.bookmarks.init(c,u)});var h=$("#pali-script-select");function p(t){$("html").css("font-size",t+"px")}function g(t,e,n,a){t.forEach(function(t,n){var a=$("<span/>").append((0,r.UT)(t[0])),i=$(t[1]).addClass("example");$("<div/>").addClass("option").append(a,i).attr("value",n).appendTo(e)}),e.on("click",".option",function(t){var e=r.appSettings.set(n,$(t.currentTarget).attr("value"));a(e)}).children("[value="+r.appSettings.get(n)+"]").addClass("active")}r.appSettings.paliScriptList.forEach(function(t,e){l.Util.createLanguageSelectOption(e,t).appendTo(h)}),h.on("click",".option",function(t){var e=$(t.currentTarget);console.log("Pali script changing from "+r.appSettings.get("paliScript")+" to "+e.attr("value")),r.appSettings.set("paliScript",e.attr("value")),c.changeScript(),u.changeScript(),f.changeScript(),s.bookmarks.changeScript()}).children("[value="+r.appSettings.get("paliScript")+"]").addClass("active"),r.appSettings.uiLanguageList.forEach(function(t,e){l.Util.createLanguageSelectOption(e,t).appendTo($("#ui-lang-select"))}),$("#ui-lang-select").on("click",".option",function(t){r.appSettings.set("uiLanguage",$(t.currentTarget).attr("value")),r.LangHelper.changeTranslation(r.appSettings.get("uiLanguage"))}).children("[value="+r.appSettings.get("uiLanguage")+"]").addClass("active"),g(r.appSettings.footnoteFormatList,$("#footnote-format-select"),"footnoteFormat",u.changeTextFormat.bind(u)),g(r.appSettings.pageTagFormatList,$("#pagetag-format-select"),"pageTagFormat",u.changeTextFormat.bind(u)),g(r.appSettings.textSizeList,$("#text-size-select"),"textSize",p),$(".custom-radio").on("click",".option",function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),u.getNumTabs()&&a.vManager.showPane("back")}),$("#columns-button").click(function(t){return u.switchView()}),r.LangHelper.changeTranslation(r.appSettings.get("uiLanguage")),p(r.appSettings.get("textSize"))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileDisplay=void 0;var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(1),o=n(0),s=n(4),l=n(6);var c=new Map([["cha","1-2-3"],["tit","1-2"],["sub","1"]]);e.FileDisplay=function(){function t(e,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.fileId=r,this.collection=new s.Collection(a,this.root,this.fileId,n),this.linkHandler=new s.LinkHandler(this),this.lineToOpen=i,this.data="",this.script=o.appSettings.get("paliScript"),this.registerClicks()}return a(t,[{key:"load",value:function(){var t=this,e=new XMLHttpRequest;e.open("GET","../static/text/"+this.fileId+".txt",!0),e.responseType="arraybuffer",e.onload=function(n){t.data=function(t){for(var e=[],n=0;n<t.length;n+=32768)e.push(String.fromCharCode.apply(null,t.subarray(n,n+32768)));return e.join("")}(new Uint16Array(e.response)),t.refresh(),t.openAndHighlightLine(t.lineToOpen)},e.send()}},{key:"openAndHighlightLine",value:function(t){this.linkHandler.openAndHighlightLine(t)}},{key:"registerClicks",value:function(){var t=this;this.root.on("click","n.click",function(t){return s.Note.showNoteBox(t)}).on("click","[tt] .line-text",function(e){var n=$(e.currentTarget).parent();t.openTitleDiv(n),t.scrollToDiv(n)}).on("click",".hangnum,.titnum",function(e){return t.collection.renderOnClick(e)})}},{key:"openTitleDiv",value:function(t){var e=t.toggleClass("open").nextUntil("[tt|="+t.attr("tt")+"]");e.filter(":not([tt])").toggle(t.hasClass("open")),e.filter("[tt]").toggleClass("open",t.hasClass("open"))}},{key:"scrollToDiv",value:function(t){this.root.parent().scrollTop(this.root.parent().scrollTop()+t.position().top)}},{key:"changeScript",value:function(){this.script!=o.appSettings.get("paliScript")&&(this.script=o.appSettings.get("paliScript"),this.refresh())}},{key:"refresh",value:function(){var t=this;this.root.empty().attr("script",this.script),i.TextProcessor.basicConvert(this.data,this.script).split("\r\n").forEach(function(e,n){t.root.append(t.getDivForLine(e,n))}),1==this.root.find("[tt]").length&&this.root.find("[tt]").children(".line-text").click(),this.root.children(".cha").first().prevUntil().show(),this.collection.renderTop()}},{key:"getDivForLine",value:function(t,e){var n=this.lineToParts(t),a=r(n,3),i=a[0],o=a[1],s=a[2],u=$("<div/>").addClass(i).attr("line-ind",e+1),f=this.textLineRender(s,i),h=$("<i/>").addClass("far fa-share share-icon action-icon");if(c.has(i)){o&&$("<span/>").addClass("titnum").text(o+".").appendTo(u);var p=l.bookmarks.getIcon(this.fileId,e+1);u.attr("tt",c.get(i)).append(f,h,p)}else o?$("<span/>").addClass("hangnum "+(o.length>4?"long":"")).text(o+".").append(h).appendTo(u):$.inArray(i,["bod","gax","gae"])>=0&&$("<span/>").addClass("hangnum").appendTo(u),u.append(f).hide();return u}},{key:"lineToParts",value:function(t){var e=t.split(":");return t&&(e.length<2||e.length>3)&&console.log("malformed line "+t+" in file "+this.fileId),[e[0],e.length>2?e[1]:"",e[e.length-1]]}},{key:"textLineRender",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t=i.TextProcessor.beautify(t,this.script,e);var n=$("<span/>").addClass("line-text").html(t);return s.Note.render(n),s.PageTag.render(n),n}}]),t}()}]);