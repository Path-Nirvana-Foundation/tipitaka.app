!function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=8)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.appSettings=e.LangHelper=e.stringResources=void 0,e.UT=function(t){const e=p.get(t);return $("<i/>").addClass("UT").attr("en-text",t).attr("lang",e?d.get("uiLanguage"):i.EN).text(e||t)},e.PT=function(t){return $("<i/>").addClass("PT").attr("si-text",t).attr("script",d.get("paliScript")).text(a.TextProcessor.convert(t,d.get("paliScript")))},e.PT_REFRESH=function(t){$("i.PT",t).each((t,e)=>{let s=$(e).attr("si-text");s=a.TextProcessor.convert(s,d.get("paliScript")),$(e).text(s).attr("script",d.get("paliScript"))})};var a=s(1);const i=Object.freeze({SI:"si",EN:"en"}),r=new Map([[i.SI,["","සිංහල",[],{f:"sl_flag.png"}]],[i.EN,["","English",[],{f:"uk_flag.png"}]]]),n=new Map([["none",["Do Not Show",""]],["click",["Show On Click",'<n><i class="far fa-asterisk"></i></n>']],["inline",["Show Inline","<n>[…]</n>"]]]),o=new Map([["none",["Do Not Show",""]],["click",["Show On Click",'<pd class="T">¶</pd>']],["short",["Short Name",'<pd class="T">[T 1.34]</pd>']],["full",["Full Name",'<pd class="T">[Thai 3.41]</pd>']]]),l=new Map([["12",["Smallest",'<i style="font-size: 12px">Aa</i>']],["14",["Smaller",'<i style="font-size: 14px">Aa</i>']],["16",["Medium",'<i style="font-size: 16px">Aa</i>']],["19",["Larger",'<i style="font-size: 18px">Aa</i>']],["22",["Largest",'<i style="font-size: 20px">Aa</i>']],["26",["XL",'<i style="font-size: 22px">Aa</i>']],["32",["XXL",'<i style="font-size: 24px">Aa</i>']]]),c={footnoteFormat:"inline",pageTagFormat:"click",textSize:"16",uiLanguage:i.EN,tabViewFormat:"tabbed",ftsSelected:!1};const h=e.stringResources={"copy-link":"Link has been copied to the clipboard. You can now paste it."};let p=new Map;class g{static extractLanguageStrings(t){g.loadTranslation(t).then(function(){const t=new Map(data_trans);$("i.UT").each((e,s)=>{const a=$(s).attr("lang")==i.EN?$(s).text().trim():$(s).attr("en-text");t.has(a)||t.set(a,"")}),Object.entries(h).forEach(([e,s])=>{t.has(s)||t.set(s,"")});const e=[];t.forEach((t,s)=>e.push(s,t)),console.log(e.join("\r\n"))})}static loadTranslation(t){const e=`./scripts/translations/${t}_trans.js`;return $.getScript(e,function(t,s,a){console.log(`Translation script with data length ${t.length} was loaded from file ${e}. \n                Status '${s}:${a.status}`)})}static changeTranslation(t){console.log(`changing UI language to ${t}`),t!=i.EN?g.loadTranslation(t).then(function(){p=new Map(data_trans),$("i.UT").each((e,s)=>{const a=$(s).attr("en-text")||$(s).text().trim();a||console.error(`UT found with empty en-text ${$(s)}`),p.has(a)?$(s).attr("en-text",a).attr("lang",t).text(p.get(a)):$(s).attr("lang",i.EN)})}):$("i.UT").each((t,e)=>$(e).text($(e).attr("en-text")||$(e).text().trim())).attr("lang",t)}}e.LangHelper=g;const d=e.appSettings=new class{constructor(){this.settings={},this.loadFromStorage(),this.paliScriptList=a.paliScriptInfo,this.uiLanguageList=r,this.footnoteFormatList=n,this.pageTagFormatList=o,this.textSizeList=l}set(t,e){return this.settings[t]=e,localStorage.setItem("settings",JSON.stringify(this.settings)),e}get(t){return this.settings[t]}loadFromStorage(){const t=localStorage.getItem("settings");this.settings=t?JSON.parse(t):{},this.settings.paliScript?this.paliScriptSource="storage":(this.paliScriptSource="default",this.settings.paliScript=a.Script.SI),this.loadDefaults()}loadDefaults(){Object.keys(c).forEach(t=>{this.settings[t]||(this.settings[t]=c[t])})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=Object.freeze({SI:"si",HI:"hi",RO:"ro",THAI:"th",LAOS:"lo",MY:"my",KM:"km",BENG:"be",GURM:"gm",THAM:"tt",GUJA:"gj",TELU:"te",KANN:"ka",MALA:"mm",BRAH:"br",TIBT:"tb",CYRL:"cy"}),i=new Map([[a.SI,["Sinhala","සිංහල",[[3456,3583]],{f:"sl_flag.png"}]],[a.HI,["Devanagari","हिन्दी",[[2304,2431]],{f:"in_flag.png"}]],[a.RO,["Roman","Roman",[[0,383],[7680,7935]],{f:"uk_flag.png"}]],[a.THAI,["Thai","ไทย",[[3584,3711]],{f:"th_flag.png"}]],[a.LAOS,["Laos","ລາວ",[[3712,3839]],{f:"laos_flag.png"}]],[a.MY,["Myanmar","ဗမာစာ",[[4096,4223]],{f:"my_flag.png"}]],[a.KM,["Khmer","ភាសាខ្មែរ",[[6016,6143]],{f:"kh_flag.png"}]],[a.BENG,["Bengali","বাংলা",[[2432,2559]],{f:"bangla_flag.png"}]],[a.GURM,["Gurmukhi","ਗੁਰਮੁਖੀ",[[2560,2687]],{}]],[a.THAM,["Tai Tham","Tai Tham LN",[[6688,6831]],{c:"beta-script"}]],[a.GUJA,["Gujarati","ગુજરાતી",[[2688,2815]],{}]],[a.TELU,["Telugu","తెలుగు",[[3072,3199]],{}]],[a.KANN,["Kannada","ಕನ್ನಡ",[[3200,3327]],{}]],[a.MALA,["Malayalam","മലയാളം",[[3328,3455]],{}]],[a.BRAH,["Brahmi","Brāhmī",[[55300,55300],[56320,56447]],{}]],[a.TIBT,["Tibetan","བོད་སྐད།",[[3840,4095]],{f:"tibet_flag.png",c:"larger"}]],[a.CYRL,["Cyrillic","кириллица",[[1024,1279],[768,879]],{f:"russia_flag.png"}]]]);function r(t){for(let e of i)for(let s of e[1][2])if(t>=s[0]&&t<=s[1])return e[0];return-1}const n={[a.SI]:0,[a.HI]:1,[a.RO]:2,[a.THAI]:3,[a.LAOS]:4,[a.MY]:5,[a.KM]:6,[a.BENG]:7,[a.GURM]:8,[a.THAM]:9,[a.GUJA]:10,[a.TELU]:11,[a.KANN]:12,[a.MALA]:13,[a.BRAH]:14,[a.TIBT]:15,[a.CYRL]:16},o=[["අ","अ","a","อ","ອ","အ","អ","অ","ਅ","ᩋ","અ","అ","ಅ","അ","𑀅","ཨ","а"],["ආ","आ","ā","อา","ອາ","အာ","អា","আ","ਆ","ᩌ","આ","ఆ","ಆ","ആ","𑀆","ཨཱ","аа"],["ඉ","इ","i","อิ","ອິ","ဣ","ឥ","ই","ਇ","ᩍ","ઇ","ఇ","ಇ","ഇ","𑀇","ཨི","и"],["ඊ","ई","ī","อี","ອີ","ဤ","ឦ","ঈ","ਈ","ᩎ","ઈ","ఈ","ಈ","ഈ","𑀈","ཨཱི","ий"],["උ","उ","u","อุ","ອຸ","ဥ","ឧ","উ","ਉ","ᩏ","ઉ","ఉ","ಉ","ഉ","𑀉","ཨུ","у"],["ඌ","ऊ","ū","อู","ອູ","ဦ","ឩ","ঊ","ਊ","ᩐ","ઊ","ఊ","ಊ","ഊ","𑀊","ཨཱུ","уу"],["එ","ए","e","เอ","ເອ","ဧ","ឯ","এ","ਏ","ᩑ","એ","ఏ","ಏ","ഏ","𑀏","ཨེ","з"],["ඔ","ओ","o","โอ","ໂອ","ဩ","ឱ","ও","ਓ","ᩒ","ઓ","ఓ","ಓ","ഓ","𑀑","ཨོ","о"],["ං","ं","ṁ","ํ","ໍ","ံ","ំ","ং","ਂ","ᩴ","ં","ం","ಂ","ം","𑀁","ཾ","м̣"],["ඃ","ः","ḥ","ะ","ະ","း","ះ","ঃ","ਃ","ᩡ","ઃ","ః","ಃ","ഃ","𑀂","ཿ","х̣"],["්","्","","ฺ","຺","္","្","্","੍","᩠","્","్","್","്","𑁆","྄",""],["0","०","0","๐","໐","၀","០","০","੦","᪐","૦","౦","೦","൦","𑁦","༠","0"],["1","१","1","๑","໑","၁","១","১","੧","᪑","૧","౧","೧","൧","𑁧","༡","1"],["2","२","2","๒","໒","၂","២","২","੨","᪒","૨","౨","೨","൨","𑁨","༢","2"],["3","३","3","๓","໓","၃","៣","৩","੩","᪓","૩","౩","೩","൩","𑁩","༣","3"],["4","४","4","๔","໔","၄","៤","৪","੪","᪔","૪","౪","೪","൪","𑁪","༤","4"],["5","५","5","๕","໕","၅","៥","৫","੫","᪕","૫","౫","೫","൫","𑁫","༥","5"],["6","६","6","๖","໖","၆","៦","৬","੬","᪖","૬","౬","೬","൬","𑁬","༦","6"],["7","७","7","๗","໗","၇","៧","৭","੭","᪗","૭","౭","೭","൭","𑁭","༧","7"],["8","८","8","๘","໘","၈","៨","৮","੮","᪘","૮","౮","೮","൮","𑁮","༨","8"],["9","९","9","๙","໙","၉","៩","৯","੯","᪙","૯","౯","೯","൯","𑁯","༩","9"]],l=[["ක","क","k","ก","ກ","က","ក","ক","ਕ","ᨠ","ક","క","ಕ","ക","𑀓","ཀ","г"],["ඛ","ख","kh","ข","ຂ","ခ","ខ","খ","ਖ","ᨡ","ખ","ఖ","ಖ","ഖ","𑀔","ཁ","к"],["ග","ग","g","ค","ຄ","ဂ","គ","গ","ਗ","ᨣ","ગ","గ","ಗ","ഗ","𑀕","ག","г̇"],["ඝ","घ","gh","ฆ","ຆ","ဃ","ឃ","ঘ","ਘ","ᨥ","ઘ","ఘ","ಘ","ഘ","𑀖","གྷ","гх"],["ඞ","ङ","ṅ","ง","ງ","င","ង","ঙ","ਙ","ᨦ","ઙ","ఙ","ಙ","ങ","𑀗","ང","н̇"],["ච","च","c","จ","ຈ","စ","ច","চ","ਚ","ᨧ","ચ","చ","ಚ","ച","𑀘","ཙ","ж"],["ඡ","छ","ch","ฉ","ຉ","ဆ","ឆ","ছ","ਛ","ᨨ","છ","ఛ","ಛ","ഛ","𑀙","ཚ","ч"],["ජ","ज","j","ช","ຊ","ဇ","ជ","জ","ਜ","ᨩ","જ","జ","ಜ","ജ","𑀚","ཛ","ж̇"],["ඣ","झ","jh","ฌ","ຌ","ဈ","ឈ","ঝ","ਝ","ᨫ","ઝ","ఝ","ಝ","ഝ","𑀛","ཛྷ","жх"],["ඤ","ञ","ñ","ญ","ຎ","ဉ","ញ","ঞ","ਞ","ᨬ","ઞ","ఞ","ಞ","ഞ","𑀜","ཉ","н̃"],["ට","ट","ṭ","ฏ","ຏ","ဋ","ដ","ট","ਟ","ᨭ","ટ","ట","ಟ","ട","𑀝","ཊ","д"],["ඨ","ठ","ṭh","ฐ","ຐ","ဌ","ឋ","ঠ","ਠ","ᨮ","ઠ","ఠ","ಠ","ഠ","𑀞","ཋ","т"],["ඩ","ड","ḍ","ฑ","ຑ","ဍ","ឌ","ড","ਡ","ᨯ","ડ","డ","ಡ","ഡ","𑀟","ཌ","д̣"],["ඪ","ढ","ḍh","ฒ","ຒ","ဎ","ឍ","ঢ","ਢ","ᨰ","ઢ","ఢ","ಢ","ഢ","𑀠","ཌྷ","дх"],["ණ","ण","ṇ","ณ","ຓ","ဏ","ណ","ণ","ਣ","ᨱ","ણ","ణ","ಣ","ണ","𑀡","ཎ","н̣"],["ත","त","t","ต","ຕ","တ","ត","ত","ਤ","ᨲ","ત","త","ತ","ത","𑀢","ཏ","д̇"],["ථ","थ","th","ถ","ຖ","ထ","ថ","থ","ਥ","ᨳ","થ","థ","ಥ","ഥ","𑀣","ཐ","т̇"],["ද","द","d","ท","ທ","ဒ","ទ","দ","ਦ","ᨴ","દ","ద","ದ","ദ","𑀤","ད","д̣̇"],["ධ","ध","dh","ธ","ຘ","ဓ","ធ","ধ","ਧ","ᨵ","ધ","ధ","ಧ","ധ","𑀥","དྷ","д̇х"],["න","न","n","น","ນ","န","ន","ন","ਨ","ᨶ","ન","న","ನ","ന","𑀦","ན","н"],["ප","प","p","ป","ປ","ပ","ប","প","ਪ","ᨸ","પ","ప","ಪ","പ","𑀧","པ","б"],["ඵ","फ","ph","ผ","ຜ","ဖ","ផ","ফ","ਫ","ᨹ","ફ","ఫ","ಫ","ഫ","𑀨","ཕ","п"],["බ","ब","b","พ","ພ","ဗ","ព","ব","ਬ","ᨻ","બ","బ","ಬ","ബ","𑀩","བ","б̣"],["භ","भ","bh","ภ","ຠ","ဘ","ភ","ভ","ਭ","ᨽ","ભ","భ","ಭ","ഭ","𑀪","བྷ","бх"],["ම","म","m","ม","ມ","မ","ម","ম","ਮ","ᨾ","મ","మ","ಮ","മ","𑀫","མ","м"],["ය","य","y","ย","ຍ","ယ","យ","য","ਯ","ᨿ","ય","య","ಯ","യ","𑀬","ཡ","я"],["ර","र","r","ร","ຣ","ရ","រ","র","ਰ","ᩁ","ર","ర","ರ","ര","𑀭","ར","р"],["ල","ल","l","ล","ລ","လ","ល","ল","ਲ","ᩃ","લ","ల","ಲ","ല","𑀮","ལ","л"],["ළ","ळ","ḷ","ฬ","ຬ","ဠ","ឡ","ল়","ਲ਼","ᩊ","ળ","ళ","ಳ","ള","𑀴","ལ༹","л̣"],["ව","व","v","ว","ວ","ဝ","វ","ৰ","ਵ","ᩅ","વ","వ","ವ","വ","𑀯","ཝ","в"],["ස","स","s","ส","ສ","သ","ស","স","ਸ","ᩈ","સ","స","ಸ","സ","𑀲","ས","с"],["හ","ह","h","ห","ຫ","ဟ","ហ","হ","ਹ","ᩉ","હ","హ","ಹ","ഹ","𑀳","ཧ","х"]],c=[["ා","ा","ā","า","າ","ာ","ា","া","ਾ","ᩣ","ા","ా","ಾ","ാ","𑀸","ཱ","аа"],["ි","ि","i","ิ","ິ","ိ","ិ","ি","ਿ","ᩥ","િ","ి","ಿ","ി","𑀺","ི","и"],["ී","ी","ī","ี","ີ","ီ","ី","ী","ੀ","ᩦ","ી","ీ","ೀ","ീ","𑀻","ཱི","ий"],["ු","ु","u","ุ","ຸ","ု","ុ","ু","ੁ","ᩩ","ુ","ు","ು","ു","𑀼","ུ","у"],["ූ","ू","ū","ู","ູ","ူ","ូ","ূ","ੂ","ᩪ","ૂ","ూ","ೂ","ൂ","𑀽","ཱུ","уу"],["ෙ","े","e","เ","ເ","ေ","េ","ে","ੇ","ᩮ","ે","ే","ೇ","േ","𑁂","ེ","з"],["ො","ो","o","โ","ໂ","ော","ោ","ো","ੋ","ᩮᩣ","ો","ో","ೋ","ോ","𑁄","ོ","о"]];function h(t,e,s=""){return"cen"==s?t=t.replace(/॥/g,""):s.startsWith("ga")&&(t=(t=t.replace(/।/g,";")).replace(/॥/g,".")),t=(t=(t=(t=t.replace(/॰…/g,"…")).replace(/॰/g,"·")).replace(/[।॥]/g,".")).replace(/\s([\s,!;\?\.])/g,"$1")}function p(t,e,s=""){if(e==a.THAI)return t.replace(/([ก-ฮ])([เโ])/g,"$2$1");if(e==a.LAOS)return t.replace(/([ກ-ຮ])([ເໂ])/g,"$2$1");throw new Error(`Unsupported script ${e} for swap_e_o method.`)}function g(t,e){if(e==a.THAI||e==a.LAOS)return t.replace(/([ෙො])([ක-ෆ])/g,"$2$1");throw new Error(`Unsupported script ${e} for un_swap_e_o method.`)}function d(t){return t.replace(/\u200C|\u200D/g,"")}const u=[],f={[a.SI]:[function(t,e,s=""){return t.replace(/\u0DCA([\u0DBA\u0DBB])/g,"්‍$1")},h],[a.RO]:[h,function(t,e,s=""){return(t=(t=t.replace(/^(\S)/g,(t,e)=>e.toUpperCase())).replace(/([\.\?]\s)(\S)/g,(t,e,s)=>`${e}${s.toUpperCase()}`)).replace(/([\u201C‘])(\S)/g,(t,e,s)=>`${e}${s.toUpperCase()}`)}],[a.THAI]:[p,h],[a.LAOS]:[p,h],[a.MY]:[function(t,e,s=""){return(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/[,;]/g,"၊")).replace(/[\u2026\u0964\u0965]+/g,"။")).replace(/ဉ\u1039ဉ/g,"ည")).replace(/သ\u1039သ/g,"ဿ")).replace(/င္([က-ဠ])/g,"င်္$1")).replace(/္ယ/g,"ျ")).replace(/္ရ/g,"ြ")).replace(/္ဝ/g,"ွ")).replace(/္ဟ/g,"ှ")).replace(/([ခဂဒပဝ](:?္[က-ဠ])?ေ?)ာ/g,"$1ါ")},h],[a.KM]:[h],[a.THAM]:[function(t){return(t=(t=(t=t.replace(/\u1A60\u1A41/g,"ᩕ")).replace(/\u1A48\u1A60\u1A48/g,"ᩔ")).replace(/।/g,"᪨")).replace(/॥/g,"᪩")}],[a.GUJA]:[h],[a.TELU]:[h],[a.MALA]:[h],[a.BRAH]:[function(t){return(t=(t=t.replace(/।/g,"𑁇")).replace(/॥/g,"𑁈")).replace(/–/g,"𑁋")},h],[a.TIBT]:[function(t){t=(t=t.replace(/।/g,"།")).replace(/॥/g,"༎");for(let e=0;e<=39;e++)t=t.replace(new RegExp(String.fromCharCode(3972,3904+e),"g"),String.fromCharCode(3984+e));return(t=(t=(t=(t=t.replace(/\u0F61\u0FB1/g,"ཡྻ")).replace(/\u0F5D\u0FAD/g,"ཝྺ")).replace(/\u0F5B\u0FAC/g,"ཛ྄ཛྷ")).replace(/\u0F61\u0FB7/g,"ཡ྄ཧ")).replace(/\u0F5D\u0FB7/g,"ཝ྄ཧ")}],[a.CYRL]:[h]},m=[],T={[a.SI]:[d],[a.HI]:[d],[a.RO]:[t=>t.toLowerCase()],[a.MY]:[function(t){return(t=(t=(t=(t=(t=(t=(t=(t=(t=t.replace(/\u102B/g,"ာ")).replace(/ှ/g,"္ဟ")).replace(/ွ/g,"္ဝ")).replace(/ြ/g,"္ရ")).replace(/ျ/g,"္ယ")).replace(/\u103A/g,"")).replace(/ဿ/g,"သ္သ")).replace(/ည/g,"ဉ္ဉ")).replace(/၊/g,",")).replace(/။/g,".")}],[a.TIBT]:[function(t){return t}]};function $(t,e,s=!0){let a=[[],[],[]];return l.concat(o,s?c:[]).forEach(s=>{s[t]&&a[s[t].length-1].push([s[t],s[e]])}),a.filter(t=>t.length).map(t=>[t[0][0].length,new Map(t)]).reverse()}function S(t,e){let s=new Array,a=0;for(;a<t.length;){let i=!1;for(let[r,n]of e){const e=t.substr(a,r);if(n.has(e)){s.push(n.get(e)),i=!0,a+=r;break}}i||(s.push(t.charAt(a)),a++)}return s.join("")}function b(t,e){const s=e==a.CYRL?"а":"a";return(t=(t=t.replace(new RegExp(`([ක-ෆ])([^ා-ෟ්${s}])`,"g"),`$1${s}$2`)).replace(new RegExp(`([ක-ෆ])([^ා-ෟ්${s}])`,"g"),`$1${s}$2`)).replace(/([ක-ෆ])$/g,`$1${s}`)}const k={"අ":"","ආ":"ා","ඉ":"ි","ඊ":"ී","උ":"ු","ඌ":"ූ","එ":"ෙ","ඔ":"ො"};function v(t,e){return t=(t=(t=t.replace(/([ක-ෆ])([^අආඉඊඋඌඑඔ])/g,"$1්$2")).replace(/([ක-ෆ])$/g,"$1්")).replace(/([ක-ෆ])([අආඉඊඋඌඑඔ])/g,(t,e,s)=>e+k[s])}const C=[x],y={[a.SI]:[],[a.RO]:[b,x],[a.CYRL]:[b,x]},w=[I],P={[a.SI]:[],[a.RO]:[E,t=>t.replace(/ṃ/g,"ං"),v],[a.CYRL]:[E,v],[a.THAI]:[I,g],[a.LAOS]:[I,g]};function x(t,e){return S(t,$(n[a.SI],n[e]))}function I(t,e){return S(t,$(n[e],n[a.SI]))}function E(t,e){return S(t,$(n[e],n[a.SI],!1))}e.TextProcessor=class{static basicConvert(t,e){return(y[e]||C).forEach(s=>t=s(t,e)),t}static basicConvertFrom(t,e){return(P[e]||w).forEach(s=>t=s(t,e)),t}static beautify(t,e,s=""){return(f[e]||u).forEach(a=>t=a(t,e,s)),t}static convert(t,e){return t=this.basicConvert(t,e),this.beautify(t,e)}static convertFrom(t,e){return(T[e]||m).forEach(s=>t=s(t,e)),this.basicConvertFrom(t,e)}static convertFromMixed(t){t=d(t)+" ";let e=-1,s="",a="";for(let i=0;i<t.length;i++){const n=r(t.charCodeAt(i));n!=e||i==t.length-1?(console.log(`process run: "${s}", i: ${i}, script: ${e}`),a+=this.convertFrom(s,e),e=n,s=t.charAt(i)):s+=t.charAt(i)}return a}},e.Script=a,e.paliScriptInfo=i,e.getScriptForCode=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitakaTree=void 0;var a=s(0);const i="../static/json/full-tree.json";class r{constructor(t){this.root=t,this.treeJson={},this.collections=[],this.fileIdToColl={}}initialize(t){return this.appTabs=t,$.getJSON(i,t=>{this.treeJson=t,this.createCollections(this.treeJson,-1),this.root.append(this.createSubtree(this.treeJson,["m"],"tree-mul")),this.root.append(this.createSubtree(this.treeJson,["a"],"tree-att")),this.root.append(this.createSubtree(this.treeJson,["t","ta"],"tree-tik")),this.root.append(this.createSubtree(this.treeJson[3].c,["e"],"tree-e")),this.registerClick(),console.log(`Tree loaded. num collections: ${this.collections.length}, num fileIds: ${Object.keys(this.fileIdToColl).length}`)}).fail(function(t,e,s){console.error("getJSON failed, status: "+e+", error: "+s)})}createSubtree(t,e,s,i){const r=$("<ul/>").attr("id",s);return t.forEach(t=>{if(t.c){for(let s of e)if(t[s]){const i=$("<a/>").append((0,a.PT)(t[s]));$("<li/>").append(i).addClass("parent").append(this.createSubtree(t.c,e,"",s)).appendTo(r)}}else if(t[`f${i}`]){const e=$("<a/>").append((0,a.PT)(t[i])),s=t[`f${i}`];$("<li/>").append(e).attr("file-id",s).appendTo(r)}}),r}addCollection(t,e){const s=this.collections.length,a={id:s,p:e,n:[]};return Object.keys(t).forEach(e=>{if("c"!=e&&!e.startsWith("f")){const i=t[`f${e}`];i?(a.n.push([e,t[e],i]),this.fileIdToColl[i]=s):a.n.push([e,t[e]])}}),this.collections.push(a),s}createCollections(t,e){t.forEach(t=>{t.c?this.createCollections(t.c,this.addCollection(t,e)):this.addCollection(t,e)})}changeScript(){(0,a.PT_REFRESH)(this.root)}registerClick(){this.root.on("click","li > a",t=>{var e=$(t.currentTarget).parent();if(e.hasClass("parent"))this.toggleBranch(e);else if(e.attr("file-id")){const t=e.attr("file-id"),s=this.getCollection(t),a=r.filterCollection(s,t);this.appTabs.newTab(t,a[1],s)}})}getCollection(t){return this.collections[this.fileIdToColl[t]]}static filterCollection(t,e){return t.n.filter(t=>t[0]==e||t[2]==e)[0]}toggleBranch(t){t.toggleClass("active").children("ul").slideToggle("fast")}showBranch(t){t.addClass("active").children("ul").slideDown("fast")}collapse(){$("li.parent.active",this.root).removeClass("active").children("ul").slideUp("fast")}openBranch(t){this.collapse(),$(`li[file-id=${t}]`,this.root).parents("li").each((t,e)=>this.showBranch($(e)))}}e.PitakaTree=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TSH=e.TSE=e.SearchFilter=void 0;var a=s(0);e.SearchFilter=class{constructor(t,e,s,a){this.root=t,this.topParentsInfo=e,this.cbObj=a,this.filter=new Map,s.forEach(t=>this.filter.set(t,1)),this.render(),this.registerClicks()}render(){this.table=$("<table/>").addClass("filter-table").appendTo(this.root),console.log(this.topParentsInfo),[0,1,2].forEach(t=>{const e=$("<tr/>").attr("row",t).appendTo(this.table);[0,1,2].forEach(s=>{const a=this.topParentsInfo[3*s+t];this.renderCheckBox(a[i.id],a[i.name],t,s).appendTo(e)})});const t=this.renderCheckBox(this.topParentsInfo[9][i.id],this.topParentsInfo[9][i.name],3,0).attr("colspan",3);$("<tr/>").attr("row",3).append(t).appendTo(this.table)}renderCheckBox(t,e,s,i){return $("<td/>").html((0,a.PT)(e)).attr("row",s).attr("column",i).attr("value",t).toggleClass("checked",this.filter.has(t))}registerClicks(){this.table.on("click","td",t=>{const e=$(t.currentTarget).toggleClass("checked");e.hasClass("checked")?this.filter.set(Number(e.attr("value")),1):this.filter.delete(Number(e.attr("value"))),this.cbObj.filterChanged(Array.from(this.filter.keys()))})}};const i=e.TSE=Object.freeze({id:0,name:1,type:2,parents:3,file:4,lineInd:5});e.TSH=new class{constructor(t,e,s){this.name=t,this.dataUrl=e,this.version=s,this.data=[],this.topParentsInfo=[],this.fileToTSI=new Map}async init(){this.version==localStorage.getItem(`version_${this.name}`)&&this.getLocalData()||await this.loadUrlData(),this.data.forEach(t=>{this.fileToTSI.has(t[i.file])||"cha"!=t[i.type]||this.fileToTSI.set(t[i.file],t[i.id]),t[i.parents].length||this.topParentsInfo.push([t[i.id],t[i.name]])}),console.log(`fileToTSI map created with ${this.fileToTSI.size} entries.`),console.log(`Top Parents Info created ${this.topParentsInfo}`)}getLocalData(){const t=localStorage.getItem(this.name);return t?(this.data=JSON.parse(LZString.decompressFromUTF16(t)),console.log(`${this.name} loaded of length ${this.data.length} from local storage.`),!0):(console.log(`no data in storage for ${this.name}`),!1)}async loadUrlData(){let t;try{t=await $.getJSON(this.dataUrl)}catch(t){throw new Error(`Failed to load the ${this.name}. Please check your internet connection`)}this.data=t;const e=JSON.stringify(this.data),s=LZString.compressToUTF16(e);try{localStorage.setItem(this.name,s),console.log(`Stored data of length ${s.length} to local storage. Uncompressed length ${e.length}`),localStorage.setItem(`version_${this.name}`,this.version)}catch(t){console.error(`Failed to set ${this.name} of size ${s.length} to local storage ${t}`)}}}("title-index","./static/json/title-search-index.json","2.0")},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vManager=e.PitakaTabs=void 0;var a=s(0),i=s(9);class r{constructor(t,e){this.root=t,this.appTree=e,this.tabs=new Map,this.files=new Map,this.activeTabId="",this.currentView=a.appSettings.get("tabViewFormat"),this.heads=$("div.tab-heads",this.root),this.contents=$("div.tab-contents",this.root),this.heads.add(this.contents).attr("view",this.currentView),this.registerClicks()}registerClicks(){this.heads.on("click",".tab-head",t=>{this.showTab($(t.currentTarget).attr("tab-id"))}),this.heads.on("click",".close-icon",t=>{this.removeTab($(t.currentTarget).parent().attr("tab-id")),t.stopPropagation()})}showTab(t){return!!this.tabs.has(t)&&(this.tabs.forEach(t=>t.forEach(t=>t.removeClass("active"))),this.tabs.get(t).forEach(t=>t.addClass("active")),this.activeTabId=t,!0)}removeTab(t){if(console.log(t),!this.tabs.has(t)||this.tabs.size<=1)return!1;this.tabs.get(t).forEach(t=>t.remove()),this.tabs.delete(t),this.files.delete(t),this.activeTabId==t&&this.showTab(this.tabs.keys().next().value)}newTab(t,e,s,l={}){o.showPane("text");const c=n(),h=(0,a.PT)(e.replace(/^[\(\)\d+\s\-\.]+/,"")),p=$("<span/>").append(h).addClass("head-label"),g=$("<span/>").addClass("close-icon far fa-times"),d=r.getCollIcon(t,s),u=$("<div/>").addClass("tab-head").append(d,p,g).appendTo(this.heads),f=$("<div/>").addClass("tab-content").appendTo(this.contents);u.add(f).attr("view",this.currentView).attr("file-id",t).attr("tab-id",c);const m=new i.FileDisplay(f,this,t,s,l);m.load(),this.tabs.set(c,[u,f]),this.files.set(c,m),this.showTab(c)}changeScript(){if(0==this.tabs.size)return;const t=this.tabs.get(this.activeTabId)[0];(0,a.PT_REFRESH)(t),this.files.get(this.activeTabId).changeScript()}changeTextFormat(){this.files.forEach(t=>t.refresh())}getNumTabs(){return this.tabs.size}static getCollIcon(t,e){const s=e.n.find(e=>e[2]==t)[0].charAt(0).toUpperCase();return $("<span/>").addClass(s).addClass("coll-icon").text(s)}switchView(){this.currentView="tabbed"==this.currentView?"columns":"tabbed",a.appSettings.set("tabViewFormat",this.currentView),$(".tab-content,.tab-head").add(this.heads,this.contents).attr("view",this.currentView)}}e.PitakaTabs=r;const n=()=>`id-${Math.floor(1e6*Math.random())}`;const o=e.vManager=new class{constructor(){this.curPane=this.prevPane="",this.registerEvents(),this.showPane("settings")}showPane(t){"back"==t&&(t=this.prevPane),t&&$("div.top-pane").hide(),"text"==t?$("#text-view-area").show():"settings"==t?$("#settings-area").show():"search"==t?$("#search-area").show():"bookmarks"==t?$("#bookmarks-area").show():"fts"==t&&$("#fts-area").show(),this.prevPane=this.curPane,this.curPane=t}registerEvents(){$("#settings-button").click(t=>this.showPane("settings")),$("#text-view-button").click(t=>this.showPane("text")),$("#menu-toggle").mousedown(function(t){$("#menu-list").animate({height:"toggle"},200),t.stopPropagation()}),$("#tree-toggle").mousedown(function(t){$(".pitaka-tree-container").animate({width:"toggle"},250),$(".pitaka-tree-container").toggleClass("user-opened"),t.stopPropagation()}),$("#menu-list, .pitaka-tree-container").mousedown(function(t){t.stopPropagation()}),$("body").mousedown(function(){$("#menu-list").animate({height:"hide"},350),"absolute"==$(".pitaka-tree-container").css("position")&&$(".pitaka-tree-container").animate({width:"hide"},250)}),$("dialog").click(t=>{$(t.target).is("dialog")&&t.target.close("cancelled")})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HitHighlighter=e.LinkHandler=e.Collection=e.Note=e.PageTag=void 0;var a=s(1),i=s(0),r=s(2),n=s(6);const o=new Map([["T","Thai"],["M","Myanmar"],["V","VRI"],["P","PTS"]]),l=new Map([["අ","අඞ්ගුත්තරනිකායපාලි"],["අට්ඨ","අට්ඨකථා"],["චූළනි","චූළනිද්දෙසපාලි"],["දී","දීඝනිකායපාලි"],["ඉතිවු","ඉතිවුත්තකපාලි"],["ජා","ජාතකපාලි"],["කං",[{UT:"Cambodian Edition"}]],["ක",[{UT:"Cambodian Edition"}]],["ඛු","ඛුද්දකනිකායපාලි"],["ම","මජ්ඣිමනිකායපාලි"],["මහානි","මහානිද්දෙසපාලි"],["මහාව","මහාවංස"],["මොග","මොග්ගල්ලානබ්යාකරණං (?)"],["මු","මූල (?)"],["නි","නිකාය"],["ප","පටිසම්භිදාමග්ගපාලි/ පට්ඨානපාලි"],["පී",[{UT:"Pali Text Society Edition"}]],["පෙ","පෙතවත්ථුපාලි/ පෙටකොපදෙසපාලි / පෙය්යාල"],["පු","පුග්ගලපඤ්ඤත්තිපාලි"],["පාචි","පාචිත්තියපාලි"],["පාරා","පාරාජිකකණ්ඩපාලි"],["රූ","රූපාවචර(?)"],["සං","සංයුත්තනිකායපාලි"],["සී",[{UT:"Sri Lankan Edition"}]],["ස්‍යා",[{UT:"Thai Edition"}]],["සු","සුත්තපිටක/ සුත්තං (?)"],["ථෙරගා","ථෙරගාථාපාලි"],["උදා","උදානපාලි"],["වි","විමානවත්ථුපාලි"],["විසුද්ධි","විසුද්ධිමග්ග"],["ටී","ටීකා"],["වා අස්ස",[{PT:"“තස්ස එවං අයොනිසො මනසිකරොතො ඡන්නං දිට්ඨීනං අඤ්ඤතරා දිට්ඨි උප්පජ්ජති. ‘අත්ථි මෙ අත්තා’ති වා අස්ස, සච්චතො ථෙතතො දිට්ඨි උප්පජ්ජති; ‘නත්ථි මෙ අත්තා’ති වා අස්ස සච්චතො ථෙතතො දිට්ඨි උප්පජ්ජති; (මජ්ඣිමනිකාය, මූලපණ්ණාසපාලි, 1.11)."},{UT:"Here vā= or, an indeclinable and a conjunction. Assa= tassa= to him/ his. In some editions a sandhi is made as vā+assa= vāssa."}]]]);class c{static render(t){"none"==i.appSettings.get("pageTagFormat")?t.children("pb").remove():t.children("pb").each((t,e)=>c.getPageTagDisplay($(e)))}static getPageTagDisplay(t){const[e,s,a,r]=c.decodeAttr(t);"click"==i.appSettings.get("pageTagFormat")?t.text("¶").addClass("click"):"short"==i.appSettings.get("pageTagFormat")?t.text(`[${e}: ${a}.${r}]`):t.html(`[<i>${s}</i> ${a}.${r}]`),t.addClass(e)}static showPageTagBox(t){const e=$(t.currentTarget),[s,a,i,r]=c.decodeAttr(e);$("#pagetag-book").text(i).parent().toggle(!!i),$("#pagetag-page").text(r),$("#pagetag-edition").text(a),n.Util.showDialog("pagetag-dialog","",e)}static decodeAttr(t){let e,s;for(let a of o)if(s=t.attr(a[0])){e=a;break}let[a,i]=s.split(".");return[e[0],e[1],a,i]}}e.PageTag=c;class h{static render(t){"none"==i.appSettings.get("footnoteFormat")?t.children("n").remove():"click"==i.appSettings.get("footnoteFormat")?t.children("n").each((t,e)=>{$(e).attr("text",$(e).text()).empty().addClass("click")}):t.children("n").each((t,e)=>$(e).html(`[${h.noteTextToHtml($(e).text())}]`))}static noteTextToHtml(t){return t.replace(/([^\s\(]+?[·॰])/g,"<abbr>$1</abbr>")}static showAbbrBox(t){const e=$(t.currentTarget),s=e.parents("[script]").attr("script");let r=a.TextProcessor.convertFrom(e.text().slice(0,-1),s);r=a.TextProcessor.beautify(r,a.Script.SI);const o=l.get(r);if(!o)return void console.error(`Could not find the abbreviation for the abbr ${r}`);let c=[];"string"!=typeof o?c=o.map(t=>t.PT?h.getAbbrFromPT(t.PT,s):t.UT?(0,i.UT)(t.UT):void 0):c.push(h.getAbbrFromPT(o,s)),n.Util.showDialog("abbreviations-dialog",c,e)}static getAbbrFromPT(t,e){return $("<i/>").addClass("PT").attr("script",e).text(a.TextProcessor.convert(t,e))}static showNoteBox(t){const e=$(t.currentTarget),s=$("<n/>").addClass("PT").attr("script",e.parents("[script]").attr("script")).html(h.noteTextToHtml(e.attr("text")));n.Util.showDialog("generic-dialog",s,e),s.on("click","abbr",t=>h.showAbbrBox(t))}}e.Note=h;e.Collection=class{constructor(t,e,s,a){this.collObj=t,this.root=e,this.fileId=s,this.tabs=a,this.registerClicks()}registerClicks(){this.root.on("click",".coll-button",t=>{const e=r.PitakaTree.filterCollection(this.collObj,$(t.currentTarget).attr("na"));console.log(e),this.tabs.newTab(e[2],e[1],this.collObj)})}renderTop(){this.buttons=$('<div class="coll-buttons top"/>').appendTo(this.root),this.collObj.n.filter(t=>t[2]!=this.fileId).forEach(t=>{const e=t[0].toUpperCase();$(`<span class="coll-button ${e.charAt(0)}" na="${e.toLowerCase()}">${e}</span>`).appendTo(this.buttons)})}renderOnClick(){}};class p{constructor(t){this.fileDisplay=t,this.root=this.fileDisplay.root,this.registerClicks()}static initClipboard(){new ClipboardJS(".share-icon",{text:function(t){const e=$(t),s=e.parents(".tab-content"),a=e.parents("[line-ind]").first().attr("line-ind");return p.createLink(s.attr("file-id"),a,s.attr("script"))}}).on("success",t=>n.Util.showToast((0,i.UT)(i.stringResources["copy-link"])))}registerClicks(){}openAndHighlightLine(t){if(!t)return;const e=this.root.children(`[line-ind=${t}]`).first();e&&(e.css("background-color","lightyellow"),this.openDivToShowLine(e),this.fileDisplay.scrollToDiv(e))}openDivToShowLine(t){const e=t.attr("class").split(" ")[0];let s=t;$.inArray(e,["bod","gax","gae"])>=0&&(s=t.prevAll("[tt]").first()),s.hasClass("open")||this.fileDisplay.openTitleDiv(s)}openHighlightedLines(){let t=1e10;this.root.find("f").parents("[line-ind]").each((e,s)=>{this.openDivToShowLine($(s)),t=Math.min($(s).attr("line-ind"),t)}),this.fileDisplay.scrollToDiv(this.root.children(`[line-ind=${t}]`))}static createLink(t,e,s){return`https://tipitaka.app/?a=${t}-${e}-${s}`}static tryStartupLocation(t,e){const s=n.Util.getParameterByName("a","").split("-");if(!s)return!1;let[o,l,c]=s;if(c&&a.Script[c]&&"default"==i.appSettings.paliScriptSource&&i.appSettings.set("paliScript",c),$.isNumeric(l)||(l=0),o&&!t.fileIdToColl[o])showToast(`Can not open direct link. Malformed file id ${o}`);else if(o){const s=t.getCollection(o),a=r.PitakaTree.filterCollection(s,o);return t.openBranch(o),e.newTab(o,a[1],s,{lineToOpen:Number(l)}),!0}return!1}}e.LinkHandler=p;e.HitHighlighter=class{static markOffsets(t,e){const s=new Map;e.offsets.forEach((t,e)=>t.forEach((t,a)=>s.set(t,[e,a])));const a=(t=t.replace(/([^ം-ෟ])([අ-ෆ])/g,"$1෴$2").replace(/<n>(.+?)<\/n>/g,(t,e)=>`<n>${e.replace(/෴/g,"")}</n>`)).replace(/<n>.+?<\/n>|[\u0964\u0965\u0970]|[A-Za-z0-9\.\?\,!;'"‘’“”–<>=\:\\\/\[\]\+\(\)]/g,"").replace(/[-…§\s\r\n]+/g," ").split(" ");let i=0;const r=new Map;a.forEach((t,a)=>{s.has(a)&&(r.set(i,s.get(a)),e.words[s.get(a)[1]]!=t.substring(1)&&console.log(`token ${t.substring(1)} at offset ${a} not matching with word ${e.words[s.get(a)[1]]}`)),i+=(t.match(/෴/g)||[]).length}),console.log(`spcCount: ${i}, offsetsMap: ${s.size} tagLocations Found: ${r.size}`);let n=0,o=0;return t=t.replace(/෴([^-…§\s\r\n<෴]*)/g,(t,e,s)=>{if(n++,r.has(n-1)){o++;const t=r.get(n-1);return`<f oi="${t[0]}" ti="${t[1]}">${e}</f>`}return e}),console.log(`TagLocations marked: ${o} spcCount2: ${n}`),t}};new Map([["a","aṅguttaranikāyapāli"],["aṭṭha","aṭṭhakathā"],["cūḷani","cūḷaniddesapāli"],["dī","dīghanikāyapāli"],["itivu","itivuttakapāli"],["jā","jātakapāli"],["kaṃ",[{UT:"Cambodian Edition"}]],["ka",[{UT:"Cambodian Edition"}]],["khu","khuddakanikāyapāli"],["ma","majjhimanikāyapāli"],["mahāni","mahāniddesapāli"],["mahāva","mahāvaṃsa"],["moga","moggallānabyākaraṇaṃ (?)"],["mu","mūla (?)"],["ni","nikāya"],["pa","paṭisambhidāmaggapāli/ paṭṭhānapāli"],["pī",[{UT:"Pali Text Society Edition"}]],["pe","petavatthupāli/ peṭakopadesapāli / peyyāla"],["pu","puggalapaññattipāli"],["pāci","pācittiyapāli"],["pārā","pārājikakaṇḍapāli"],["rū","rūpāvacara(?)"],["saṃ","saṃyuttanikāyapāli"],["sī",[{UT:"Sri Lankan Edition"}]],["su","suttapiṭaka/ suttaṃ (?)"],["syā",[{UT:"Thai Edition"}]],["theragā","theragāthāpāli"],["udā","udānapāli"],["vi","vimānavatthupāli"],["visuddhi","visuddhimagga"],["ṭī","ṭīkā"],["vā assa",[{PT:"“Tassa evaṃ ayoniso manasikaroto channaṃ diṭṭhīnaṃ aññatarā diṭṭhi uppajjati. ‘Atthi me attā’ti vā assa, saccato thetato diṭṭhi uppajjati; ‘natthi me attā’ti vā assa saccato thetato diṭṭhi uppajjati; (majjhimanikāya, mūlapaṇṇāsapāli, page 1.11)."},{UT:"Here vā= or, an indeclinable and a conjunction. Assa= tassa= to him/ his. In some editions a sandhi is made as vā+assa= vāssa."}]]])},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Util=class{static copyText(t){const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}static showToast(t){var e=$("#toast").html(t).fadeIn(300);setTimeout(function(){e.fadeOut()},3e3)}static getParameterByName(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===s?e:decodeURIComponent(s[1].replace(/\+/g," "))}static createLanguageSelectOption(t,e,s="./static/images/"){const a=$("<span/>").addClass("UT").text(e[1]).attr("lang",t),i=e[3].f?$("<img/>").attr("src",`${s}${e[3].f}`):"",r=$("<div/>").addClass("option").append(a,i).attr("value",t);return e[3].c&&r.addClass(e[3].c),r}static showDialog(t,e="",s=""){const a=$("#"+t);return dialogPolyfill.registerDialog(a[0]),e&&a.empty().append(e),s&&(s.addClass("highlighted"),a.on("close",t=>s.removeClass("highlighted"))),a[0].showModal(),a}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bookmarks=e.TitleSearch=void 0;var a=s(1),i=s(0),r=s(2),n=s(4),o=s(3);class l{constructor(t,e,s){this.root=t,this.tree=e,this.tabs=s,this.searchPrevQuery="",this.searchCache=new Map,this.settings={minQueryLength:2,maxResults:100}}init(){this.filterParents=i.appSettings.get("title-search-filter"),this.filterParents||(this.filterParents=o.TSH.topParentsInfo.slice(0,-1).map(t=>t[0]),i.appSettings.set("title-search-filter",this.filterParents)),this.filter=new o.SearchFilter($("#search-filter"),o.TSH.topParentsInfo,this.filterParents,this),this.registerClicks(),console.log(`search index loaded with length ${o.TSH.data.length}`)}registerClicks(){$("#search-filter-button").click(t=>$("#search-filter").slideToggle("fast")),$("#search-results").on("click","i.name",t=>l.openResult(t,this.tree,this.tabs))}static openResult(t,e,s){const a=o.TSH.data[$(t.currentTarget).attr("index")],i=a[o.TSE.file],n=e.getCollection(i),l=r.PitakaTree.filterCollection(n,i);s.newTab(i,l[1],n,{lineToOpen:Number(a[o.TSE.lineInd])}),e.openBranch(i)}performSearch(t){const e=a.TextProcessor.convertFromMixed(t);if(e!=this.searchPrevQuery)if($("#search-results",this.root).empty(),this.searchPrevQuery=e,e.length<this.settings.minQueryLength)this.setStatus(`Please enter some more characters to start the searching. Minimum: ${this.settings.minQueryLength}`);else{console.log(`starting the search with query ${e}`);const t=this.searchIndex(e);this.displayResults(t)}}checkQuery(t,e){return e.exec(t[o.TSE.name])&&(this.filterParents.length==o.TSH.topParentsInfo.length||this.filterParents.indexOf(t[o.TSE.parents][0])>=0)}searchIndex(t){if(this.searchCache.has(t)){const e=this.searchCache.get(t);return console.log(`Results for query ${t} found in cache of length ${e.length}`),e}const e=new RegExp(t,"i"),s=[];for(let t=0;t<o.TSH.data.length&&(this.checkQuery(o.TSH.data[t],e)&&s.push(t),!(s.length>=this.settings.maxResults));t++);return console.log(`Search for ${t} in index found ${s.length} hits`),this.searchCache.set(t,s),s}setStatus(t){$("#search-status",this.root).empty().append((0,i.UT)(t))}displayResults(t){const e=$("#search-results",this.root).empty();t?(e.append(l.createResultsList(t)),e.show(),t.length<this.settings.maxResults?this.setStatus(`The number of entries found for your search term ${t.length}`):this.setStatus(`Too many results found. Number of results shown ${this.settings.maxResults}`)):this.setStatus("Your search term did not return any results. Please try another term.")}changeScript(){(0,i.PT_REFRESH)(this.root)}filterChanged(t){this.filterParents=t,i.appSettings.set("title-search-filter",this.filterParents),console.log(t),this.searchCache.clear();const e=this.searchIndex(this.searchPrevQuery);this.displayResults(e)}static createResultsList(t){return t.map(t=>{const e=o.TSH.data[t],s=$("<div/>").addClass("search-result").attr("index",t);return e[o.TSE.parents].forEach(t=>{(0,i.PT)(o.TSH.data[t][o.TSE.name]).addClass("parent name").attr("index",t).appendTo(s),$("<i/>").text(" » ").appendTo(s)}),(0,i.PT)(e[o.TSE.name]).addClass("child name").attr("index",t).appendTo(s),c.getIcon(e[o.TSE.file],e[o.TSE.lineInd]).appendTo(s),s})}}e.TitleSearch=l;const c=e.bookmarks=new class{constructor(){this.list={}}init(t,e){this.tree=t,this.tabs=e;const s=localStorage.getItem("bookmarks");s&&(this.list=JSON.parse(s)),this.registerClicks(),this.updateCount(),this.filterParents=i.appSettings.get("bookmarks-filter"),this.filterParents||(this.filterParents=o.TSH.topParentsInfo.map(t=>t[0]),i.appSettings.set("bookmarks-filter",this.filterParents)),this.filter=new o.SearchFilter($("#bookmarks-filter"),o.TSH.topParentsInfo,this.filterParents,this)}registerClicks(){$("body").on("click","i.save-icon",t=>{const e=$(t.currentTarget),s=e.attr("key");this.list[s]?(e.removeClass("saved"),delete this.list[s],console.log(`bookmark ${s} deleted`)):(e.addClass("saved"),this.list[s]=Date.now(),console.log(`bookmark ${s} added`)),localStorage.setItem("bookmarks",JSON.stringify(this.list)),this.updateCount()}),$("#bookmarks-button").click(t=>{this.renderBookmarks(),n.vManager.showPane("bookmarks")}),$("#bookmarks-filter-button").click(t=>$("#bookmarks-filter").slideToggle("fast")),$("#bookmarks-list").on("click","i.name",t=>l.openResult(t,this.tree,this.tabs))}updateCount(){$("#bookmarks-count").text(Object.keys(this.list).length)}getIcon(t,e){const s=`${t},${e}`;return $("<i/>").addClass("far fa-star save-icon action-icon").toggleClass("saved",this.list[s]>0).attr("key",s)}renderBookmarks(){const t=$("#bookmarks-list").empty();if(!Object.keys(this.list).length)return void this.setStatus("You have no bookmarks saved. Click the star icon to save to bookmarks.");const e=[];o.TSH.data.forEach(t=>{const s=`${t[o.TSE.file]},${t[o.TSE.lineInd]}`;this.list[s]&&this.checkFilter(t)&&e.push(t[o.TSE.id])}),t.append(l.createResultsList(e)),this.setStatus(`The number of bookmarks found matching your filter ${e.length}`)}checkFilter(t){return this.filterParents.length==o.TSH.topParentsInfo.length||this.filterParents.indexOf(t[o.TSE.parents][0])>=0}filterChanged(t){this.filterParents=t,i.appSettings.set("bookmarks-filter",this.filterParents),this.renderBookmarks()}setStatus(t){$("#bookmarks-status").empty().append((0,i.UT)(t))}changeScript(){(0,i.PT_REFRESH)($("#bookmarks-area"))}}},function(t,e,s){"use strict";var a=s(1),i=s(0),r=s(4),n=s(2),o=s(5),l=s(3),c=s(7),h=s(10),p=s(6);const g=new n.PitakaTree($(".pitaka-tree")),d=new r.PitakaTabs($(".text-section"),g);g.initialize(d).done(function(){o.LinkHandler.initClipboard(),o.LinkHandler.tryStartupLocation(g,d)});const u=new c.TitleSearch($("#search-area"),g,d),f=new h.FTSHandler;function m(t){t&&t.stopPropagation();const e=$(".search-bar").val().trim();T?(r.vManager.showPane("fts"),f.performSearch(e)):(r.vManager.showPane("search"),u.performSearch(e));const s=(0,a.getScriptForCode)(e?e.charCodeAt(0):0);$(".search-bar").attr("script",s)}l.TSH.init().then(()=>{$(".search-bar").on("keyup compositionend",t=>m(t)),$(".search-bar").focus(t=>T?r.vManager.showPane("fts"):r.vManager.showPane("search")),u.init(),c.bookmarks.init(g,d),f.init(g,d)}).catch(t=>{console.error(`Title Search Index init failed with error ${t}`)});let T=!1;$("#fts-select-button").click(t=>(function(t){$("#fts-select-button").toggleClass("active",t).children().toggleClass("fal",!t).toggleClass("fas",t),(T=t)&&f.checkInit(),m()})(!T));const S=$("#pali-script-select");function b(t){$("html").css("font-size",`${t}px`)}function k(t,e,s,a){t.forEach((t,s)=>{const a=$("<span/>").append((0,i.UT)(t[0])),r=$(t[1]).addClass("example");$("<div/>").addClass("option").append(a,r).attr("value",s).appendTo(e)}),e.on("click",".option",t=>{const e=i.appSettings.set(s,$(t.currentTarget).attr("value"));a(e)}).children(`[value=${i.appSettings.get(s)}]`).addClass("active")}i.appSettings.paliScriptList.forEach((t,e)=>{p.Util.createLanguageSelectOption(e,t).appendTo(S)}),S.on("click",".option",t=>{const e=$(t.currentTarget);console.log(`Pali script changing from ${i.appSettings.get("paliScript")} to ${e.attr("value")}`),i.appSettings.set("paliScript",e.attr("value")),g.changeScript(),d.changeScript(),u.changeScript(),c.bookmarks.changeScript(),f.changeScript()}).children(`[value=${i.appSettings.get("paliScript")}]`).addClass("active"),i.appSettings.uiLanguageList.forEach((t,e)=>{p.Util.createLanguageSelectOption(e,t).appendTo($("#ui-lang-select"))}),$("#ui-lang-select").on("click",".option",t=>{i.appSettings.set("uiLanguage",$(t.currentTarget).attr("value")),i.LangHelper.changeTranslation(i.appSettings.get("uiLanguage"))}).children(`[value=${i.appSettings.get("uiLanguage")}]`).addClass("active"),k(i.appSettings.footnoteFormatList,$("#footnote-format-select"),"footnoteFormat",d.changeTextFormat.bind(d)),k(i.appSettings.pageTagFormatList,$("#pagetag-format-select"),"pageTagFormat",d.changeTextFormat.bind(d)),k(i.appSettings.textSizeList,$("#text-size-select"),"textSize",b),$(".custom-radio").on("click",".option",t=>{$(t.currentTarget).addClass("active").siblings().removeClass("active"),d.getNumTabs()&&r.vManager.showPane("back")}),$("#columns-button").click(t=>d.switchView()),i.LangHelper.changeTranslation(i.appSettings.get("uiLanguage")),b(i.appSettings.get("textSize"))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FileDisplay=void 0;var a=s(1),i=s(0),r=s(5),n=s(7);const o=new Map([["cha","1-2-3"],["tit","1-2"],["sub","1"]]);e.FileDisplay=class{constructor(t,e,s,a,n){this.root=t,this.fileId=s,this.collection=new r.Collection(a,this.root,this.fileId,e),this.linkHandler=new r.LinkHandler(this),this.lineToOpen=n.lineToOpen||0,this.highlight=n,this.data="",this.script=i.appSettings.get("paliScript"),this.registerClicks()}load(){const t=new XMLHttpRequest;t.open("GET",`../static/text/${this.fileId}.txt`,!0),t.responseType="arraybuffer",t.onload=(e=>{this.data=function(t){const e=[];for(let s=0;s<t.length;s+=32768)e.push(String.fromCharCode.apply(null,t.subarray(s,s+32768)));return e.join("")}(new Uint16Array(t.response)),this.highlight.words&&(this.data=r.HitHighlighter.markOffsets(this.data,this.highlight)),this.refresh(),this.linkHandler.openAndHighlightLine(this.lineToOpen),this.highlight.words&&this.linkHandler.openHighlightedLines()}),t.send()}registerClicks(){this.root.on("click","n.click",t=>r.Note.showNoteBox(t)).on("click","abbr",t=>r.Note.showAbbrBox(t)).on("click","pb",t=>r.PageTag.showPageTagBox(t)).on("click","[tt] .line-text",t=>{const e=$(t.currentTarget).parent();this.openTitleDiv(e),this.scrollToDiv(e)}).on("click",".hangnum,.titnum",t=>this.collection.renderOnClick(t))}openTitleDiv(t){const e=t.toggleClass("open").nextUntil(`[tt|=${t.attr("tt")}]`);e.filter(":not([tt])").toggle(t.hasClass("open")),e.filter("[tt]").toggleClass("open",t.hasClass("open"))}scrollToDiv(t){t&&this.root.scrollTop(this.root.scrollTop()+t.position().top)}changeScript(){this.script!=i.appSettings.get("paliScript")&&(this.script=i.appSettings.get("paliScript"),this.refresh())}refresh(){this.root.empty().attr("script",this.script),a.TextProcessor.basicConvert(this.data,this.script).split("\r\n").forEach((t,e)=>{this.root.append(this.getDivForLine(t,e))}),1==this.root.find("[tt]").length&&this.root.find("[tt]").children(".line-text").click(),this.root.children(".cha").first().prevUntil().show(),this.collection.renderTop()}getDivForLine(t,e){const[s,a,i]=this.lineToParts(t),r=$("<div/>").addClass(s).attr("line-ind",e+1),l=this.textLineRender(i,s),c=$("<i/>").addClass("far fa-share share-icon action-icon");if(o.has(s)){a&&$("<span/>").addClass("titnum").text(a+".").appendTo(r);const t=n.bookmarks.getIcon(this.fileId,e+1);r.attr("tt",o.get(s)).append(l,c,t)}else a?$("<span/>").addClass(`hangnum ${a.length>4?"long":""}`).text(a+".").append(c).appendTo(r):$.inArray(s,["bod","gax","gae"])>=0&&$("<span/>").addClass("hangnum").appendTo(r),r.append(l).hide();return r}lineToParts(t){const e=t.split(":");return t&&(e.length<2||e.length>3)&&console.log(`malformed line ${t} in file ${this.fileId}`),[e[0],e.length>2?e[1]:"",e[e.length-1]]}textLineRender(t,e=""){t=a.TextProcessor.beautify(t,this.script,e);const s=$("<span/>").addClass("line-text").html(t);return r.Note.render(s),r.PageTag.render(s),s}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FTSHandler=void 0;var a=s(0),i=s(1),r=s(2),n=s(3);const o=!1,l=["1","abcde","2","3","fghij","4","5","klmno","6","pqrstuvwxy"];e.FTSHandler=class{constructor(){this.prevTerms=[],this.matchesStore=null,this.settings={minQueryLength:3,maxMatches:100,maxFiles:100,searchDelay:400},this.requestTimer="",this.options={exactWord:!0,exactPhrase:!0,matchOrder:!0,wordDistance:10,maxMatches:this.settings.maxMatches,maxFiles:this.settings.maxFiles}}init(t,e){this.appTree=t,this.appTabs=e,this.filterParents=a.appSettings.get("fts-search-filter"),this.filterParents||(this.filterParents=n.TSH.topParentsInfo.slice(0,-1).map(t=>t[0]),a.appSettings.set("fts-search-filter",this.filterParents)),this.filter=new n.SearchFilter($("#fts-filter"),n.TSH.topParentsInfo,this.filterParents,this),this.registerClicks()}registerClicks(){$(".option[hide=exactPhrase]").toggleClass("hidden",this.options.exactPhrase),$("#fts-options").on("click",".check-box",t=>{const e=$(t.currentTarget).toggleClass("checked");this.options[e.attr("param")]=e.hasClass("checked"),$(".option[hide=exactPhrase]").toggleClass("hidden",this.options.exactPhrase),this.scheduleSearchIndex()}),$("#input-word-distance").change(()=>{const t=Number($("#input-word-distance").val());t<=0||t>=100?this.setStatus("Allowed Range for word distance 1 - 99."):(this.options.wordDistance=t,this.scheduleSearchIndex())}),$("#fts-filter-button").click(t=>$("#fts-filter").slideToggle("fast")),$("#fts-match-list").on("click",".search-result",t=>{this.displayInfo($(t.currentTarget).attr("matchInd"))}),$("#fts-match-info").on("click","i.name",t=>this.openResult(t))}performSearch(t){const e=t.replace(/\s+/g," ").replace(/[\d\,!;"‘’“”–<>=\:]/g,"");if(e.length<this.settings.minQueryLength)return void this.setStatus(`Please enter some more characters to start the searching. Minimum: ${this.settings.minQueryLength}`);const s=i.TextProcessor.convertFromMixed(e).split(" ");this.checkTerms(s)&&(s.length==this.prevTerms.length&&s.every((t,e)=>this.prevTerms[e]==t)||(this.prevTerms=s,this.scheduleSearchIndex()))}checkTerms(t){return!!(t&&t.length&&t.every(t=>/[අ-ෆ]/.exec(t)))||(this.setStatus("Each of the search terms must have at least one character."),!1)}scheduleSearchIndex(){this.requestTimer&&clearTimeout(this.requestTimer),this.requestTimer=setTimeout(()=>this.searchIndex(),this.settings.searchDelay)}searchIndex(){if(!this.checkTerms(this.prevTerms))return;$("#fts-match-list,#fts-match-info").empty();const t={type:"get-matches",terms:this.prevTerms,params:this.getQueryParams()},e=o?new FTSQuery(t):new h(t);console.log(`sending query with terms ${this.prevTerms} and params ${JSON.stringify(e.params)}`),this.setBusySearching(!0),e.send().then(t=>{this.matchesStore=t,console.log(`received mstore with ${t.matches.length} matches and ${Object.keys(t.wordInfo).length} words`),this.setBusySearching(!1),this.displayMatches()}).catch(t=>{this.setBusySearching(!1),console.error(t)})}getQueryParams(){const t=this.options;if(n.TSH.topParentsInfo.length!=this.filterParents.length){const e=[];n.TSH.topParentsInfo.forEach((t,s)=>{this.filterParents.indexOf(t[0])>=0&&e.push(l[s])}),t.filter=e}else t.filter=null;return t}setBusySearching(t){$("#fts-area").toggleClass("busy-searching",t)}displayMatches(){0!=this.matchesStore.matches.length?($("#fts-match-list").append(this.matchesStore.matches.map(([t,e,s,i],r)=>{const n=$("<div/>").addClass("search-result").attr("matchInd",r);return t.forEach(t=>{(0,a.PT)(this.matchesStore.wordInfo[t][0]).addClass("token").appendTo(n)}),$("<span/>").text(e).addClass("total-freq").appendTo(n),$("<span/>").text(i).addClass("count-files").appendTo(n),n})),this.matchesStore.matches.length<this.settings.maxMatches?this.setStatus(`The number of entries found for your search term ${this.matchesStore.matches.length}`):this.setStatus(`Number of results found ${this.matchesStore.stats.considered}. Number of results shown ${this.settings.maxMatches}`),this.displayInfo(0)):this.setStatus(`Search term did not return any results. Your search term is ${this.prevTerms.join(" ")}.`)}displayInfo(t){$("#fts-match-list").children().removeClass("selected").filter(`[matchInd=${t}]`).addClass("selected");const e=this.matchesStore.matches[t];$("#fts-match-info").empty().append(e[2].map(([t,e,s],i)=>{const r=$("<div/>").addClass("search-result").attr("file",t).attr("fileInd",i),o=n.TSH.data[n.TSH.fileToTSI.get(t)];return o[n.TSE.parents].forEach(t=>{(0,a.PT)(n.TSH.data[t][n.TSE.name]).addClass("parent name").attr("index",t).appendTo(r),$("<i/>").text(" » ").appendTo(r)}),(0,a.PT)(o[n.TSE.name]).addClass("child name").attr("index",o[n.TSE.id]).appendTo(r),$("<span/>").text(s).addClass("count-files").appendTo(r),r})).attr("matchInd",t)}openResult(t){const e=$(t.currentTarget),s=n.TSH.data[e.attr("index")][n.TSE.file];if(e.parent().attr("file")!=s)return;const a=this.appTree.getCollection(s),i=r.PitakaTree.filterCollection(a,s),o=e.parents("[matchInd]").first().attr("matchInd"),l=this.matchesStore.matches[o],c=l[0].map(t=>this.matchesStore.wordInfo[t][0]),h=e.parent().attr("fileInd"),p=l[2][h][1];this.appTabs.newTab(s,i[1],a,{words:c,offsets:p}),this.appTree.openBranch(s)}filterChanged(t){this.filterParents=t,a.appSettings.set("fts-search-filter",this.filterParents),console.log(`fts filter changing to ${this.filterParents}`),this.scheduleSearchIndex()}setStatus(t){$("#fts-status",this.root).empty().append((0,a.UT)(t))}changeScript(){(0,a.PT_REFRESH)($("#fts-area"))}async checkInit(){o&&await new FTSQuery("init-data").send()}};const c="https://tipitaka.app/nodejs/fts-query/";class h{constructor(t){this.type=t.type,this.terms=t.terms,this.params=t.params}async send(){const t={type:this.type,terms:this.terms,params:this.params},e=await $.post(c,JSON.stringify(t));if(e.error)throw new Error(e.error);return e}}}]);